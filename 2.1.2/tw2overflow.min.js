/*! tw2autofarm.min.js@2.1.2 | Licence MIT */
!function(a,b){a.Lockr=function(a,b){"use strict";return Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=c<0?Math.ceil(c):Math.floor(c),c<0&&(c+=b);c<b;c++)if(c in this&&this[c]===a)return c;return-1}),b.prefix="",b._getPrefixedKey=function(a,b){return b=b||{},b.noPrefix?a:this.prefix+a},b.set=function(a,b,c){var d=this._getPrefixedKey(a,c);try{localStorage.setItem(d,JSON.stringify({data:b}))}catch(c){console&&console.warn("Lockr didn't successfully save the '{"+a+": "+b+"}' pair, because the localStorage is full.")}},b.get=function(a,b,c){var d,e=this._getPrefixedKey(a,c);try{d=JSON.parse(localStorage.getItem(e))}catch(a){d=localStorage[e]?{data:localStorage.getItem(e)}:null}return null===d?b:"object"==typeof d&&void 0!==d.data?d.data:b},b.sadd=function(a,c,d){var e,f=this._getPrefixedKey(a,d),g=b.smembers(a);if(g.indexOf(c)>-1)return null;try{g.push(c),e=JSON.stringify({data:g}),localStorage.setItem(f,e)}catch(b){console.log(b),console&&console.warn("Lockr didn't successfully add the "+c+" to "+a+" set, because the localStorage is full.")}},b.smembers=function(a,b){var c,d=this._getPrefixedKey(a,b);try{c=JSON.parse(localStorage.getItem(d))}catch(a){c=null}return null===c?[]:c.data||[]},b.sismember=function(a,c,d){return b.smembers(a).indexOf(c)>-1},b.keys=function(){var a=[],c=Object.keys(localStorage);return 0===b.prefix.length?c:(c.forEach(function(c){-1!==c.indexOf(b.prefix)&&a.push(c.replace(b.prefix,""))}),a)},b.getAll=function(a){var c=b.keys();return a?c.reduce(function(a,c){var d={};return d[c]=b.get(c),a.push(d),a},[]):c.map(function(a){return b.get(a)})},b.srem=function(a,c,d){var e,f,g=this._getPrefixedKey(a,d),h=b.smembers(a,c);f=h.indexOf(c),f>-1&&h.splice(f,1),e=JSON.stringify({data:h});try{localStorage.setItem(g,e)}catch(b){console&&console.warn("Lockr couldn't remove the "+c+" from the set "+a)}},b.rm=function(a){var b=this._getPrefixedKey(a);localStorage.removeItem(b)},b.flush=function(){b.prefix.length?b.keys().forEach(function(a){localStorage.removeItem(b._getPrefixedKey(a))}):localStorage.clear()},b}(a,{})}(this),__debug=!1,FarmOverflow=function(){function a(a){let b={};for(let c in a)a[c]>0&&(b[c]=a[c]);return b}function b(a){return c(),this.version="2.1.2",this.settings=Lockr.get("settings",{maxDistance:10,minDistance:0,maxTravelTime:"01:00:00",randomBase:3,presetName:"",groupIgnore:"",groupInclude:"",groupOnly:"",minPoints:0,maxPoints:12500,eventsLimit:20,ignoreOnLoss:!1,language:"",priorityTargets:!0,eventAttack:!0,eventVillageChange:!0,eventPriorityAdd:!0,eventIgnoredVillage:!0,remoteId:"remote",hotkeySwitch:"shift+z",hotkeyWindow:"z"},!0),this.villages=null,this.village=null,this.singleVillage=null,this.targets={},this.target=null,this.eventListeners={},this.eventsEnabled=!0,this.presets=[],this.groupIgnore=null,this.ignoredVillages=[],this.groupInclude=null,this.includedVillages=[],this.groupOnly=null,this.indexes=null,this.waiting={},this.globalWaiting=!1,this.lastError="",this.commander=new FarmOverflowCommander(this),this.priorityTargets={},this.activeListeners=[],this.updateExceptionGroups(),this.updateExceptionVillages(),this.updatePlayerVillages(),this.updatePresets(),this.updateIndexes(),this.listeners(),this.languages(),this}function c(){__debug&&console.warn.apply(this,arguments)}let d=angular.element(document).scope(),e=injector.get("modelDataService"),f=injector.get("socketService"),g=injector.get("routeProvider"),h=injector.get("eventTypeProvider"),i=e.getPresetList(),j=require("helper/math"),k=require("conf/conf"),l=require("helper/mapconvert"),m=require("struct/MapData"),n=e.getSelectedCharacter();return b.prototype.start=function(){return this.presets.length?this.presets.length?this.village?(this.commander=new FarmOverflowCommander(this),this.commander.start(),d.$broadcast(h.MESSAGE_SUCCESS,{message:this.lang.general.started}),Analytics.start(),!0):(d.$broadcast(h.MESSAGE_ERROR,{message:af.lang.events.noSelectedVillage}),!1):(d.$broadcast(h.MESSAGE_ERROR,{message:af.lang.events.presetFirst}),!1):this.event("noPreset")},b.prototype.stop=function(){return this.commander.stop(),d.$broadcast(h.MESSAGE_SUCCESS,{message:this.lang.general.paused}),Analytics.pause(),!0},b.prototype.switch=function(){this.commander&&this.commander.running?this.stop():this.start()},b.prototype.updateSettings=function(a){c();let b={},d={groupIgnore:["groups"],groupInclude:["groups","targets"],groupOnly:["groups","villages","targets"],presetName:["preset"],minDistance:["targets"],maxDistance:["targets"],minPoints:["targets"],maxPoints:["targets"]};for(let c in a){if(a[c]!==this.settings[c]){let a=d[c];if(d.hasOwnProperty(c))for(let c=0;c<a.length;c++)b[a[c]]=!0}this.settings[c]=a[c]}if(Lockr.set("settings",this.settings),angular.equals(b,{}))return!1;b.groups&&(this.updateExceptionGroups(),this.updateExceptionVillages()),b.villages&&this.updatePlayerVillages(),b.preset&&this.updatePresets(),b.targets&&(this.targets={}),this.commander.running&&this.globalWaiting&&this.disableEvents(()=>{this.stop();this.start()}),Analytics.settingsChange(localStorage[Lockr.prefix+"settings"])},b.prototype.disableEvents=function(a){c(),this.eventsEnabled=!1,a(),this.eventsEnabled=!0},b.prototype.nextTarget=function(){c();let a=this.village.id;if(!this.targets[a])return this.commander.analyse(),!1;let b=this.targets[a],d=++this.indexes[a],e=!1;for(;d<b.length;d++){let a=b[d];if(!this.ignoredVillages.includes(a.id)){this.target=a,e=!0;break}this.event("ignoredTarget",[a])}return e||(this.target=b[0],this.indexes[a]=0),Lockr.set("indexes",this.indexes),!0},b.prototype.checkTarget=function(){let a=this.village.id,b=this.indexes[a],c=this.targets[a],d=this.priorityTargets[a];if(this.settings.priorityTargets&&d&&d.length){let b=this.priorityTargets[a].pop();if(this.ignoredVillages.includes(b))return checkTarget();let d=this.targets[a].findIndex(a=>a.id===b);return this.target=c[d],this.event("priorityTargetSelected",[this.target]),!0}for(;b<c.length;b++){let d=c[b];if(d){if(this.ignoredVillages.includes(d.id))continue;return this.target=d,this.indexes[a]=b,!0}}return!1},b.mapFilters=[function(a,b){if(b.id<0)return!0},function(a,b){if(b.character_id===n.getId())return!0},function(a,b){if(b.attack_protection)return!0},function(a,b){if(b.character_id){let c=a.includedVillages.includes(b.id);if(!c)return!0}},function(a,b){return b.points<a.settings.minPoints||(b.points>a.settings.maxPoints||void 0)},function(a,b){let c=a.village.position,d=j.actualDistance(c,b);return d<a.settings.minDistance||(d>a.settings.maxDistance||void 0)}],b.prototype.getTargets=function(a){c();let d=this.village.position,e=this.village.id;if(e in this.targets)return a();let f=[],g=k.MAP_CHUNK_SIZE,h=d.x-g,i=d.y-g,n=2*g,o=2*g,p=()=>{let a=m.hasTownDataInChunk(h,i);if(a)q();else{this.event("startLoadingTargers");let a=l.scaledGridCoordinates(h,i,n,o,g),b=a.length,c=0;m.loadTownDataAsync(h,i,n,o,()=>{++c===b&&(this.event("endLoadingTargers"),q())})}return},q=()=>{let a=m.loadTownData(h,i,n,o,g);let b=a.length;for(;b--;){let c=a[b],d=c.data;for(let a in d){let b=d[a];for(let a in b){let c=b[a],d=r(c);d&&f.push(d)}}}s()},r=a=>{let c=b.mapFilters.every(b=>!b(this,a));if(!c)return!1;return{x:a.x,y:a.y,distance:j.actualDistance(d,a),id:a.id,name:a.name,pid:a.character_id}},s=()=>{if(0===f.length){let b=this.nextVillage();return b?this.getTargets(a):this.event("noTargets"),!1}this.targets[e]=f.sort(function(a,b){return a.distance-b.distance});this.indexes.hasOwnProperty(e)||(this.indexes[e]=0,Lockr.set("indexes",this.indexes));this.target=this.targets[e][0];a()};return p()},b.prototype.nextVillage=function(){if(c(),this.singleVillage)return!1;let a=this.villages.filter(a=>!this.waiting[a.id]);if(!a.length)return this.event("noVillages"),!1;if(1===a.length)return this.village=a[0],this.event("nextVillage",[this.village]),!0;let b=a.indexOf(this.village)+1;return this.village=a[b]?a[b]:a[0],this.event("nextVillage",[this.village]),!0},b.prototype.selectVillage=function(a){c();let b=this.villages.indexOf(a);return-1!==b&&(this.village=this.villages[b],!0)},b.prototype.updateIndexes=function(){if(c(),this.indexes=Lockr.get("indexes",{},!0),!angular.equals({},this.indexes)){let a=this.indexes.last;Date.now()-a>18e5&&(Lockr.rm("indexes"),this.indexes={})}},b.prototype.event=function(a,b){if(c(),!this.eventsEnabled)return this;if(a in this.eventListeners){let c=this.eventListeners[a];for(let a=0;a<c.length;a++)c[a].apply(this,b)}return this},b.prototype.on=function(a,b){return"function"==typeof b&&(a in this.eventListeners||(this.eventListeners[a]=[]),this.eventListeners[a].push(b)),this},b.prototype.updatePresets=function(b){c();let d=c=>{this.presets=[];for(let b in c)if(c.hasOwnProperty(b)){let d=c[b].name,e=d.replace(/(\(|\{|\[|\"|\')[^\)\}\]\"\']+(\)|\}|\]|\"|\')/,"").trim();e===this.settings.presetName&&(c[b].cleanName=e,c[b].units=a(c[b].units),this.presets.push(c[b]))}b&&b()};i.isLoaded()?d(i.presets):f.emit(g.GET_PRESETS,{},a=>{this.event("presetsLoaded");d(a.presets)})},b.prototype.assignPresets=function(a,b){c(),f.emit(g.ASSIGN_PRESETS,{village_id:this.village.id,preset_ids:a},b)},b.prototype.checkPresets=function(a){c();let b=this.village.id,d=i.getPresetsByVillageId(b),e=!1,f=[];for(preset of this.presets)d.hasOwnProperty(preset.id)||(e=!0,f.push(preset.id));if(e){for(let a in d)f.push(a);this.assignPresets(f,a)}else a()},b.prototype.updateExceptionGroups=function(){c();let a=["groupIgnore","groupInclude","groupOnly"],b=e.getGroupList().getGroups();for(let c of a){this[c]=null;for(let a in b){let d=b[a];if(d.name===this.settings[c]){this[c]={name:d.name,id:d.id};break}}}},b.prototype.updateExceptionVillages=function(){c();let a=e.getGroupList();this.ignoredVillages=[],this.includedVillages=[],this.groupIgnore&&(this.ignoredVillages=a.getGroupVillageIds(this.groupIgnore.id)),this.groupInclude&&(this.includedVillages=a.getGroupVillageIds(this.groupInclude.id))},b.prototype.updatePlayerVillages=function(){let a=n.getVillageList();if(a=a.map(a=>new FarmOverflowVillage(a)),a=a.filter(a=>!this.ignoredVillages.includes(a.id)),this.groupOnly){let b=e.getGroupList(),c=b.getGroupVillageIds(this.groupOnly.id);a=a.filter(a=>c.includes(a.id))}if(this.villages=a,this.singleVillage=1===this.villages.length,this.village=this.villages[0],this.commander.running&&this.globalWaiting)for(let b=0;b<a.length;b++){let c=a[b];if(!this.waiting[c.id]){this.globalWaiting=!1,this.commander.analyse();break}}this.event("villagesUpdate")},b.prototype.ignoreVillage=function(a){if(!this.groupIgnore)return!1;f.emit(g.GROUPS_LINK_VILLAGE,{group_id:this.groupIgnore.id,village_id:a.id},()=>{this.event("ignoredVillage",[a])})},b.prototype.targetExists=function(a){for(let b in this.targets){let c=this.targets[b];for(let b=0;b<c.length;b++){let d=c[b];if(d.id===a)return d}}return!1},b.prototype.listeners=function(){function a(a,b){f.emit(g.MESSAGE_REPLY,{message_id:a,message:b},function(){})}c();let b=(a,b)=>{let c=b.origin.id;if(this.waiting[c])return delete this.waiting[c],this.globalWaiting&&(this.globalWaiting=!1,this.commander.running&&(this.event("restartingCommands"),this.selectVillage(c),setTimeout(()=>{this.commander.analyse()},1e4))),!1},e=()=>{this.updatePresets();this.event("presetsChange");this.presets.length||this.commander.running&&(this.event("noPreset"),this.stop())},i=(a,b)=>{this.updateExceptionGroups();this.updateExceptionVillages();this.event("groupsChanged")},j=(a,b)=>{this.updatePlayerVillages();if(!this.groupInclude)return!1;this.groupInclude.id===b.group_id&&(this.targets={})},k=a=>{if(a.attCharacterId!==n.getId())return!1;let b=this.targetExists(a.defVillageId);if(!b)return!1;let c=a.attLosses;for(let a in c)if(c[a]>0)return this.ignoreVillage(b),Analytics.ignoreTarget(),!0;return!1},l=a=>{let b=a.haul;let c=b.wood+b.clay+b.iron;if(c===a.capacity){let b=a.attVillageId,c=a.defVillageId;this.priorityTargets[b]=this.priorityTargets[b]||[],this.priorityTargets[b].push(c),Analytics.priorityTarget()}},o=(a,b)=>{if("attack"!==b.type||!b.haul)return!1;let c=this.settings;if(!c.ignoreOnLoss&&!c.priorityTargets)return!1;f.emit(g.REPORT_GET,{id:b.id},a=>{f.emit(g.REPORT_MARK_UNREAD,{reports:[a.id]},function(){});let b=a.ReportAttack;c.ignoreOnLoss&&k(b);c.priorityTargets&&l(b)})},p=(a,b)=>{this.commander.running&&this.disableEvents(()=>{this.stop();this.start()})},q=(b,c)=>{let d=this.settings.remoteId;if(1!==c.participants.length||c.title!==d)return!1;let e=c.message.content.trim().toLowerCase();switch(e){case"on":this.stop(),this.start(),a(c.message_id,"[color=0a8028]OK[/color]"),Analytics.remoteCommand();break;case"off":this.stop(),a(c.message_id,"[color=0a8028]OK[/color]"),Analytics.remoteCommand();break;case"status":let b=$("#autofarm-status").html(),d=$("#autofarm-last").html(),f=this.village.id,g=`${this.village.name} (${this.village.x}|${this.village.y})`,h=[`[b]${this.lang.events.status}:[/b] ${b}[br]`,`[b]${this.lang.events.selectedVillage}:[/b] [village=${f}]${g}[/village][br]`,`[b]${this.lang.events.lastAttack}:[/b] ${d}`].join("");a(c.message_id,h),Analytics.remoteCommand()}return!1},r=(a,b)=>{let c=d.$on(h[a],b);this.activeListeners.push(c)};r("COMMAND_RETURNED",b),r("ARMY_PRESET_UPDATE",e),r("ARMY_PRESET_DELETED",e),r("GROUPS_UPDATED",i),r("GROUPS_CREATED",i),r("GROUPS_DESTROYED",i),r("GROUPS_VILLAGE_LINKED",j),r("GROUPS_VILLAGE_UNLINKED",j),r("REPORT_NEW",o),r("RECONNECT",p),r("MESSAGE_SENT",q),m.setRequestFn(function(a){f.emit(g.MAP_GETVILLAGES,a)})},b.prototype.hasTargets=function(){return this.targets.hasOwnProperty(this.village.id)},b.prototype.hasVillage=function(){return!!this.village},b.prototype.isWaiting=function(){return this.waiting.hasOwnProperty(this.village.id)},b.prototype.isIgnored=function(){return this.ignoredVillages.includes(this.village.id)},b.prototype.isAllWaiting=function(){for(let a=0;a<this.villages.length;a++){let b=this.villages[a].id;if(!this.waiting.hasOwnProperty(b))return!1}return!0},b.prototype.languages=function(){c();let a={pt_br:{title:"Farm Overflow",events:{attacking:"Atacando.",commandLimit:"Limite de 50 ataques atingido, aguardando retorno.",lastAttack:"Último ataque",nextVillage:"Alternando para a aldeia {0}",noPreset:"Nenhuma predefinição disponível.",noSelectedVillage:"Nenhuma aldeia disponível.",noUnits:"Sem unidades na aldeia, aguardando ataques retornarem.",noUnitsNoCommands:"Nenhuma aldeia tem tropas nem ataques retornando.",noVillages:"Nenhuma aldeia disponível, aguardando ataques retornarem.",nothingYet:"Nada por aqui ainda...",paused:"Pausado.",presetFirst:"Configure uma predefinição primeiro!",selectedVillage:"Aldeia selecionada",sendCommand:"{0} ataca {1}",status:"Status",loadingTargets:"Carregando alvos...",checkingTargets:"Checando alvos...",restartingCommands:"Reiniciando comandos...",ignoredVillage:"Alvo {0} ignorado! (causou baixas)",priorityTargetAdded:"{0} adicionado as prioridades."},general:{disabled:"Desativado",events:"Eventos",info:"Informações",none:"Nenhum",pause:"Pausar",paused:"AutoFarm pausado.",settings:"Configurações",start:"Iniciar",started:"AutoFarm iniciado."},info:{development:["Desenvolvimento","Desenvolvido do <span class='brazil'>Brasil</span> com <strong style='color:#ad0202'>❤</strong> por","Qualquer email reportando erro, sugestão, mensagem amor ou ódio será bem vinda.","Esse projeto é"],groupOnly:["Usando apenas aldeias de um grupo para atacar","Você pode selecionar um grupo especifico para usar apenas as aldeias desse grupo para enviar os ataques."],ignore:["Ignorando aldeias com grupo","Você pode selecionar um grupo nas configurações para que todas aldeias atribuidas a esse grupo sejam ignorados pelo AutoFarm. <strong>O grupo serve tanto para os alvos quanto para suas aldeias</strong>."],include:["Incluindo alvos com grupo","Assim como ignorar aldeias, você pode incluir como alvos aldeias de jogadores. Todas aldeias do grupo que estiverem fora da distância máxima não seram incluidas."],presets:["Configurando predefinições","As predefinição que não estiverem ativadas nas aldeias serão ativadas automaticamente.","Atenção! Se as predefinições tiverem <strong>oficiais</strong>, eles <strong>serão utilizados</strong>.","É possível utilizar mais de uma predefinição, <strong>desde que tenham uma mesma identificação</strong>.","É permitido adicionar uma descrição em conjunto com a identificação da predefinição. A descrição deve estar no final do nome e entre chaves, colchetes, parênteses, aspas ou aspas-simples.","Exemplo de alguns nome de predefinições:"],randomBase:["Base do intervalo aleatório","Esse intervalo é usado para gerar um tempo aleatório (em segundos) entre cada ataque evitando o script ser detectado. <strong>Quanto maior melhor</strong>."],ignoreOnLoss:["Ignorando alvos que causam perdas","Qualquer ataque que tenha causado alguma perca nas suas tropas será ignorado em ataques futuros.",'<strong>Atenção</strong>: Para essa funcionalidade funcionar é preciso ter a opção "Ignorando aldeias com grupo" configurada.','Todas aldeias que forem ignoradas será avisado na aba "Avisos".'],priorityTargets:["Priorizando alvos","Quando ativada, todos os alvos que tiverem relatórios com saque no máximo, serão adicionados na lista de prioridades para reenviar o ataque assim que possível."],remote:["Controlando remotamente o script via mensagem (Experimental)","Deixe o script funcionando em casa e o controle pelo app do jogo!",'Configure o assunto da mensagem por onde você controlará o script na aba "Configurações"',"Crie uma mensagem e adicione você mesmo como destinatário. No assunto coloque o que você configurou e no corpo da mensagem use um dos seguintes comandos:","inicia o farm","pausa o farm","recebe o status atual do farm","Se você não receber uma mensagem de OK em retorno, quer dizer que o script não recebeu a mensagem ou que um comando inválido foi usado.","Atenção: Só funciona se você for o único participante da mensagem!","Você pode usar a mesma mensagem para executar outros comandos, bastando responde-la."]},settings:{basicSettings:"Configurações Básicas",eventsLimit:"Número máximo de registros",groupIgnore:"Ignorar aldeias do grupo",groupInclude:"Incluir alvos do grupo",groupOnly:"Atacar apenas com aldeias do grupo",language:"Linguagem da interface (requer reinício)",maxDistance:"Distância máxima dos alvos",maxTravelTime:"Tempo máximo de viagem (ida)",minDistance:"Distância mínima dos alvos",others:"Outros",presetName:"Predefinição das tropas",randomBase:"Base do intervalo aleatório (segundos)",ignoreOnLoss:"Ignorar aldeias que causarem perdas<br/>(Necessita de um grupo de ignorados ativo)",save:"Salvar configurações",saved:"Configurações salvas!",filters:"Filtros",presets:"Predefinições",villages:"Aldeias",security:"Segurança",minPoints:"Pontuação mínima dos alvos",maxPoints:"Pontuação máxima dos alvos",priorityTargets:"Priorizar alvos com de saque lotado",events:"Eventos",eventAttack:"Mostrar eventos de ataques",eventVillageChange:"Mostrar eventos de troca de aldeias",eventPriorityAdd:"Mostrar eventos de alvos prioritarios",eventIgnoredVillage:"Mostrar eventos de aldeias ignoradas",remote:"Controlar script via mensagem (assunto)",hotkeySwitch:"Tecla de atalho para inicar/pausar (requer reinício)",hotkeyWindow:"Tecla de atalho para abrir janela (requer reinício)"}},en_us:{title:"Farm Overflow",events:{attacking:"Attacking.",commandLimit:"Limit of 50 attacks reached, waiting return.",lastAttack:"Last attack",nextVillage:"Changing to village {0}",noPreset:"No presets avaliable.",noSelectedVillage:"No villages avaliable.",noUnits:"No units avaliable in village, waiting attacks return.",noUnitsNoCommands:"No villages has units or commands returning.",noVillages:"No villages avaliable, waiting attacks return.",nothingYet:"Nothing available yet...",paused:"Paused.",presetFirst:"Set a preset first!",selectedVillage:"Village selected",sendCommand:"{0} attack {1}",status:"Status",loadingTargets:"Loading targets...",checkingTargets:"Checking targets...",restartingCommands:"Restarting commands...",ignoredVillage:"Target {0} ignored! (caused loss)",priorityTargetAdded:"{0} added to priorities."},general:{disabled:"Disabled",events:"Task Logs",info:"Information",none:"None",pause:"Pause",paused:"AutoFarm paused.",settings:"Settings",start:"Start",started:"AutoFarm started."},info:{development:["Development","Developed from <span class='brazil'>Brazil</span> with <strong style='color:#ad0202'>❤</strong> by","Any email reporting error, suggestion, messages of love or hate will be wellcome.","This project is"],groupOnly:["Using only villages from a group to attack","You can select a specific group to use only the villages from that group to attack."],ignore:["Ignoring villages from a group","You can select ignore targets setting a Ignore Group. All villages that assigned in that group will be ignored by the script. <strong>The group works on targets and your own villages as well</strong>."],include:["Including targets with a group","As well as ignoring villages, you can include village targets of players. Works only in villages inside the maximum distance range."],presets:["Setting presets","The preset that hasn't assigned to the villages will be automatically.","Attention! If the presets have <strong>officers</strong>, they <strong>will be used</strong>.","It's possible to have more than one preset, <strong>since it has the same identification</strong>.","Is permitted include some description along side the identification. The description must be between keys, brackets, parentheses, single or double quotes.","Exemples of some preset names:"],randomBase:["Random interval base","That interval is a random period of time (in seconds) between each attack avoid the script to be detected by the game. <strong>The bigger the better</strong>."],ignoreOnLoss:["Ignoring targets that cause loss","This option will ignore any target that cause loss in your troops.","The target that cause any loss to your troops will be ignored in the future.",'<strong>Note</strong>: For this feature works properly, the option "Ignore villages from group" must be set.'],priorityTargets:["Prioritizing targets","When activated, all targets that has full haul reports, will be added to the list of priorities, to resend the attack as soon as possible."],remote:["Controlling the script remotelly via message (Experimental)","Let the script working in home and control it by the app of game!",'Set the subject of message where you will control the script in the "Settings" tab',"Create a message and add yourself as a recipient. On the subject put what you set, and in the message use one of the fallowing commands:","start the farm","pause the farm","receive the current status of farm",'If you don\'t receive the message "OK" in return, means that the script did not receive the message or the command was invalid.',"Attentin: Works only if you are the only participant in the message!","You can use the same message to execute other commands, just reply the message."]},settings:{basicSettings:"Basic Settings",eventsLimit:"Maximum length of events",groupIgnore:"Ignore villages from group",groupInclude:"Include targets from group",groupOnly:"Attack only with villages from group",language:"Interface language (require restart)",maxDistance:"Targets maximum distance",maxTravelTime:"Maximum travel time (going)",minDistance:"Targets minimum distance",others:"Others",presetName:"Preset of troops",randomBase:"Random interval base (seconds)",ignoreOnLoss:"Ignore villages that cause loss<br/>(Need a active group of ignoreds)",save:"Save settings",saved:"Settings saved!",filters:"Filters",presets:"Presets",villages:"Villages",security:"Security",minPoints:"Targets minimum points",maxPoints:"Targets maximum points",priorityTargets:"Prioritize targets with full loot report",events:"Events",eventAttack:"Show events of attacks",eventVillageChange:"Show events of village's changes",eventPriorityAdd:"Show events of priority targets",eventIgnoredVillage:"Show events of ignored villages",remote:"Control script via message (subject)",hotkeySwitch:"Hotkey to start/pause",hotkeyWindow:"Hotkey to open window"}}},b=require("conf/locale").LANGUAGE,d={pt_pt:"pt_br",en_dk:"en_us"};if(b in d&&(b=d[b]),this.settings.language)this.lang=a[this.settings.language];else{let c=b in a?b:"en_us";this.lang=a[c],this.settings.language=c}},b}(),FarmOverflowCommander=function(){function a(a){a=parseInt(a,10);let b=a+a/2,c=a-a/2;return Math.round(Math.random()*(b-c)+c)}function b(a){return a=a.split(":"),a[0]=60*parseInt(a[0],10)*60,a[1]=60*parseInt(a[1],10),a[2]=parseInt(a[2],10),a.reduce((a,b)=>a+b)}function c(a){this.autofarm=a,this.preventNextCommand=!1,this.timeoutId=null,this.running=!1}let d=angular.element(document).scope(),e=injector.get("routeProvider"),f=injector.get("eventTypeProvider"),g=injector.get("socketService"),h=injector.get("armyService"),i=require("helper/math");return c.prototype.start=function(){this.autofarm.event("start"),this.running=!0,this.analyse()},c.prototype.stop=function(){this.autofarm.event("pause"),this.running=!1,clearTimeout(this.timeoutId)},c.prototype.analyse=function(){let a=this.autofarm;return!!this.running&&(a.hasVillage()?a.isWaiting()||a.isIgnored()?(a.nextVillage()?this.analyse():a.event(a.lastError),!1):a.hasTargets()?a.checkTarget()?void a.checkPresets(()=>{if(a.village.countCommands()>=48)return this.handleError("commandLimit");let b=this.getPreset();if(b.error)return this.handleError(b.error);this.getPresetNext(b);this.send(b)}):(a.nextVillage()?this.analyse():a.event("noTargets"),!1):(a.getTargets(()=>{a.checkTarget()||a.nextVillage();this.analyse()}),!1):a.event("noVillageSelected"))},c.prototype.handleError=function(a){a=a||this.preventNextCommand;let b=this.autofarm;this.preventNextCommand=!1,b.lastError=a;let c=b.village.id;switch(a){case"timeLimit":b.nextTarget(),this.analyse();break;case"noUnits":if(b.event("noUnits",[b.village]),b.waiting[c]=!0,b.singleVillage){if(0===b.village.countCommands())return b.event("noUnitsNoCommands");b.globalWaiting=!0}else b.nextVillage()?this.analyse():b.globalWaiting=!0;break;case"commandLimit":if(b.waiting[c]=!0,b.singleVillage)b.globalWaiting=!0,b.event("commandLimitSingle",[b.village]);else{if(b.isAllWaiting())return b.event("commandLimitMulti",[b.village]),b.globalWaiting=!0,!1;b.nextVillage(),this.analyse()}}},c.prototype.getPreset=function(a){log("getPreset");let b=this.autofarm,c=!1,d=a||b.village.units;for(let a of b.presets){let b=!0;for(let c in a.units)d[c].in_town<a.units[c]&&(b=!1);if(b){if(this.checkPresetTime(a))return a;c=!0}else;}return{error:c?"timeLimit":"noUnits"}},c.prototype.getPresetNext=function(a){log("getPresetNext");let b=this.autofarm,c=angular.copy(b.village.units),d=a.units;for(let a in d)c[a].in_town-=d[a];let e=this.getPreset(c);e.error&&(this.preventNextCommand=e.error)},c.prototype.checkPresetTime=function(a){log("checkPresetTime");let c=this.autofarm,d=b(c.settings.maxTravelTime),e=c.village.position,f={x:c.target.x,y:c.target.y},g=i.actualDistance(e,f),j=h.calculateTravelTime(a,{barbarian:!c.village.pid,officers:!1});return d>h.getTravelTimeForDistance(a,j,g,"attack")},c.prototype.send=function(b,c){if(log("send"),!this.running)return!1;let d,f,h=this.autofarm;return this.simulate(),d=this.onCommandError(()=>{f();h.village.updateCommands(()=>{this.analyse()})}),f=this.onCommandSend(()=>{d();h.nextTarget();let b;b=a(h.settings.randomBase);b=1e3+1e3*b;this.timeoutId=setTimeout(()=>{if(this.preventNextCommand)return this.handleError();this.analyse()},b)}),g.emit(e.SEND_PRESET,{start_village:h.village.id,target_village:h.target.id,army_preset_id:b.id,type:"attack"}),!0},c.prototype.onCommandSend=function(a){let b=this.autofarm,c=angular.copy(b.village.units),e=d.$on(f.VILLAGE_UNIT_INFO,(d,f)=>{if(b.village.id!==f.village_id)return!1;let g=b.village.units;let h=angular.equals(c,g);if(h)return!1;b.event("sendCommand",[b.village,b.target]);Analytics.attack();e();a()});return e},c.prototype.onCommandError=function(a){let b=(this.autofarm,d.$on(f.MESSAGE_ERROR,(c,d)=>{if("Command/sendPreset"!==d.cause)return!1;if("Command/attackLimitExceeded"!==d.code)return!1;Analytics.attackError();b();a()}));return b},c.prototype.simulate=function(a){log("simulate");let b=this.autofarm;(()=>{g.emit(e.GET_ATTACKING_FACTOR,{target_id:b.target.id})})(),a&&a()},c}(),FarmOverflowVillage=function(){function a(a){this.village=a,this.id=a.data.villageId,this.x=a.data.x,this.y=a.data.y,this.name=a.data.name,this.units=a.unitInfo.units,this.position=this.village.getPosition()}let b=injector.get("socketService"),c=injector.get("routeProvider"),d=require("models/CommandListModel"),e=require("models/CommandModel");return a.prototype.countCommands=function(){let a=this.village.getCommandListModel();return a.getOutgoingCommands(!0).length+a.getIncomingCommands(!0).length},a.prototype.updateCommands=function(a){b.emit(c.GET_OWN_COMMANDS,{village_id:this.id},b=>{let c=new d([],this.id);for(let a=0;a<b.commands.length;a++){let d=new e(b.commands[a]);c.add(d)}this.village.setCommandListModel(c);a()})},a}(),FarmOverflowInterface=function(){function a(a,b){return a.replace(/{(\d+)}/g,function(a,c){return void 0!==b[c].html?b[c].html:a})}function b(a,b){let c,d,e=/{{(.+?)}}/g,f="with(obj) { var r=[];\n",g=0,h=function(a,b){f+=b?a.match(/(^( )?(var|if|for|else|switch|case|break|{|}|;))(.*)?/g)?a+"\n":"r.push("+a+");\n":""!=a?'r.push("'+a.replace(/"/g,'\\"')+'");\n':""};for(;d=e.exec(a);)h(a.slice(g,d.index)),h(d[1],!0),g=d.index+d[0].length;h(a.substr(g,a.length-g)),f=(f+'return r.join(""); }').replace(/[\r\t\n]/g," ");try{c=new Function("obj",f).apply(b,[b])}catch(a){}return c}function c(a,c,d){let e=Math.round(1e5*Math.random()),f=b('<a id="l{{ id }}" class="img-link icon-20x20-{{ icon }} btn btn-orange padded">{{ text }}</a>',{icon:a,text:c,id:e}),g=document.createElement("div");return g.innerHTML=f,g=g.firstChild,g.addEventListener("click",function(){h.openVillageInfo(d)}),{html:f,id:"l"+e,elem:g}}function d(a){return this.autofarm=a,this.newSettings={},this.activeTab="info",this.events=Lockr.get("lastEvents",[],!0),this.eventCount=1,this.buildStyle(),this.buildWindow(),this.bindTabs(),this.bindSettings(),this.bindEvents(),this.updateGroupList(),this.populateEvents(),a.presets.length?this.updatePresetList():a.on("presetsLoaded",()=>{this.updatePresetList()}),a.on("presetsChange",()=>{this.updatePresetList()}),a.on("groupsChanged",()=>{this.updateGroupList()}),this.$close.on("click",()=>{this.closeWindow()}),k.add("esc",()=>{this.closeWindow()},["INPUT","SELECT","TEXTAREA"]),e.$on(g.WINDOW_CLOSED,()=>{this.closeWindow()}),this.$button.on("click",()=>{this.openWindow()}),this.$start.on("click",()=>{a.switch()}),k.add(a.settings.hotkeySwitch,()=>{a.switch()}),k.add(a.settings.hotkeyWindow,()=>{this.openWindow()}),a.on("start",()=>{this.$start.html(a.lang.general.pause);this.$start.removeClass("btn-green").addClass("btn-red");this.$button.removeClass("btn-green").addClass("btn-red")}),a.on("pause",()=>{this.$start.html(a.lang.general.start);this.$start.removeClass("btn-red").addClass("btn-green");this.$button.removeClass("btn-red").addClass("btn-green")}),this}let e=angular.element(document).scope(),f=injector.get("modelDataService"),g=injector.get("eventTypeProvider"),h=injector.get("windowDisplayService"),i=injector.get("windowManagerService"),j=injector.get("$filter"),k=injector.get("hotkeys"),l=require("queues/EventQueue"),m=f.getSelectedCharacter();return d.prototype.populateEvents=function(){let a=parseInt(this.autofarm.settings.eventsLimit,10);this.events.length>0&&this.$events.html("");for(let b=0;b<this.events.length&&!(this.eventCount>=a);b++)this.addEvent(this.events[b],!0),this.eventCount++},d.prototype.buildStyle=function(){this.$style=document.createElement("style"),this.$style.type="text/css",this.$style.id="autofarm-style",
this.$style.innerHTML='#autofarm-interface{position:relative;top:0;left:0;margin-bottom:10px}#autofarm-interface .button{white-space:nowrap;position:relative;top:0;left:0;width:60px;height:24px}#autofarm-interface .text,#autofarm-interface .quickview{margin:5px 0;font-size:12px}#autofarm-interface .quickview{display:none}#wrapper.window-open #autofarm-interface .button{left:720px}#autofarm-window{visibility:hidden}#autofarm-window p,#autofarm-window h3{color:#000}#autofarm-window p{margin:7px 0;padding:0 40px}#autofarm-window p span.sample{font-weight:bold;font-style:italic}#autofarm-window p span.brazil{color:green;font-weight:bold}#autofarm-window p .opensource{background:url(https://i.imgur.com/KFHdWXN.png);width:15px;height:15px;display:inline-block;vertical-align:-2px}#autofarm-window input[type=text],#autofarm-window input[type=number]{width:100%}#autofarm-window select{width:100%;padding:0 0 0 5px;font-size:14px;border:1px solid #976543;height:28px;text-decoration:none;text-align:left;border-radius:2px;font-weight:600;font-family:"Trebuchet MS";color:white;box-shadow:0 0 0 1px #421f09 inset,0 0 0 2px #976543 inset,0 0 0 3px #421f09 inset,0 -1px 1px 4px rgba(215,181,144,0.7) inset,0 0 1px 5px rgba(0,0,0,0.4) inset;-webkit-appearance:none;-moz-appearance:none;outline:none;background-image:url(https://i.imgur.com/SlaWRrX.png),url(https://i.imgur.com/e2qKrmX.png);background-repeat:no-repeat,repeat;background-position:293px -3px,top left;background-color:#b28e68}#autofarm-window .center{text-align:center}#autofarm-window .reduced{height:30px}#autofarm-window .autofarm-content-info a{font-weight:bold;color:#544231}#autofarm-settings input[type="text"],#autofarm-settings input[type="number"],#autofarm-settings select{color:black}#autofarm-settings [class^="icon-"]{display:inline;margin:0 9px 0 0}#autofarm-settings .icon-34x34-preset,#autofarm-settings .icon-26x26-time,#autofarm-settings .icon-26x26-info,#autofarm-settings .icon-26x26-double-arrow{zoom:.6}#autofarm-settings .icon-20x20-queue-indicator-short,#autofarm-settings .icon-20x20-queue-indicator-long,#autofarm-settings .icon-20x20-favourite{vertical-align:0;margin:0 5px 0 0}#autofarm-settings .icon-34x34-preset,#autofarm-settings .icon-26x26-time{vertical-align:3px}#autofarm-settings .icon-26x26-double-arrow{vertical-align:4px}#autofarm-settings .icon-26x26-info{vertical-align:5px}#autofarm-settings .icon-34x34-points-per-village,#autofarm-settings .icon-34x34-name_changed{zoom:.5;vertical-align:6px}#autofarm-settings .icon-26x26-message-misc{vertical-align:1px}#autofarm-settings .icon-34x34-general{zoom:.5}#autofarm-settings .icon-26x26-time-spy{zoom:.7}#autofarm-settings td{text-align:center}#autofarm-save{color:white;width:180px;height:25px;margin:6px;line-height:24px;border:none}@keyframes autofarmShowStatus{0%{width:60px}100%{width:220px}}@keyframes autofarmHideStatus{0%{width:220px}100%{width:60px}}.autofarm-show-status{animation:autofarmShowStatus .1s forwards}.autofarm-hide-status{animation:autofarmHideStatus .1s forwards}@-webkit-keyframes promo-animated{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}@-moz-keyframes promo-animated{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}@keyframes promo-animated{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}',document.querySelector("head").appendChild(this.$style)},d.prototype.buildWindow=function(){this.$wrapper=$("#wrapper"),this.$window=document.createElement("section"),this.$window.id="autofarm-window",this.$window.className="autofarm-window twx-window screen left";let a=angular.merge({version:this.autofarm.version,author:{name:"Relaxeaza",email:"mafrazzrafael@gmail.com",url:"https://gitlab.com/mafrazz/"}},this.autofarm.lang),c=b('<div class="win-content message-list-wrapper searchable-list ng-scope"><header class="win-head"><h2 class="ng-binding">{{ this.title }} <span class="small">v{{ this.version }}</span></h2><ul class="list-btn"><li><a href="#" id="autofarm-close" class="size-34x34 btn-red icon-26x26-close"></a></li></ul></header><div class="win-main"><div class="tabs tabs-bg"><div class="tabs-three-col"><div class="tab" tab="info"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange">{{ this.general.info }}</a></div></div></div><div class="tab" tab="settings"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange">{{ this.general.settings }}</a></div></div></div><div class="tab" tab="log"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange">{{ this.general.events }}</a></div></div></div></div></div><div class="box-paper footer has-footer-upper autofarm-content-info"><p class="center"><img src="https://i.imgur.com/rbUaOGx.png"></p><h5 class="twx-section">{{ this.info.development[0] }}</h5><div><p class="center">{{ this.info.development[1] }} <a href="{{ this.author.url }}">{{ this.author.name }}</a> &lt;{{ this.author.email }}&gt;</p><p class="center">{{ this.info.development[2] }}</p><p class="center">{{ this.info.development[3] }} <span class="opensource"></span> <a href="https://gitlab.com/scriptw/autofarm/">Open Source</a></p></div><h5 class="twx-section">{{ this.info.presets[0] }}</h5><div><p>{{ this.info.presets[1] }}</p><p>{{ this.info.presets[2] }}</p><p>{{ this.info.presets[3] }}</p><p>{{ this.info.presets[4] }}</p><p>{{ this.info.presets[5] }}</p><p>{{ this.info.presets[6] }}</p><p>{{ this.info.presets[7] }} <span class="sample">Farm (Spears)</span> — <span class="sample">Farm "Lança"</span> — <span class="sample">Farm {Cavalary}</span></p></div><h5 class="twx-section">{{ this.info.ignore[0] }}</h5><div><p>{{ this.info.ignore[1] }}</p></div><h5 class="twx-section">{{ this.info.include[0] }}</h5><div><p>{{ this.info.include[1] }}</p></div><h5 class="twx-section">{{ this.info.randomBase[0] }}</h5><div><p>{{ this.info.randomBase[1] }}</p></div><h5 class="twx-section">{{ this.info.groupOnly[0] }}</h5><div><p>{{ this.info.groupOnly[1] }}</p></div><h5 class="twx-section">{{ this.info.ignoreOnLoss[0] }}</h5><div><p>{{ this.info.ignoreOnLoss[1] }}</p><p>{{ this.info.ignoreOnLoss[2] }}</p><p>{{ this.info.ignoreOnLoss[3] }}</p></div><h5 class="twx-section">{{ this.info.priorityTargets[0] }}</h5><div><p>{{ this.info.priorityTargets[1] }}</p></div><h5 class="twx-section">{{ this.info.remote[0] }}</h5><div><p>{{ this.info.remote[1] }}</p><p>{{ this.info.remote[2] }}</p><p>{{ this.info.remote[3] }}</p><p>&bull; <b>on</b> <i>{{ this.info.remote[4] }}</i></p><p>&bull; <b>off</b> <i>{{ this.info.remote[5] }}</i></p><p>&bull; <b>status</b> <i>{{ this.info.remote[6] }}</i></p><p>{{ this.info.remote[7] }}</p><p>{{ this.info.remote[8] }}</p><p>{{ this.info.remote[9] }}</p></div></div><div class="box-paper footer has-footer-upper autofarm-content-settings"><form id="autofarm-settings"><h5 class="twx-section">{{ this.settings.presets }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="icon-34x34-preset"></span> <span class="ff-cell-fix">{{ this.settings.presetName }}</span></td><td><select name="presetName" id="autofarm-preset"></select></td></tr></tbody></table><h5 class="twx-section">{{ this.settings.villages }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="icon-20x20-queue-indicator-short"></span> <span class="ff-cell-fix">{{ this.settings.groupIgnore }}</span></td><td><select name="groupIgnore" id="autofarm-ignore"></select></td></tr><tr><td><span class="icon-20x20-queue-indicator-long"></span> <span class="ff-cell-fix">{{ this.settings.groupInclude }}</span></td><td><select name="groupInclude" id="autofarm-include"></select></td></tr><tr><td><span class="icon-20x20-favourite"></span> <span class="ff-cell-fix">{{ this.settings.groupOnly }}</span></td><td><select name="groupOnly" id="autofarm-only"></select></td></tr><tr><td><span class="icon-34x34-name_changed"></span> <span class="ff-cell-fix">{{ this.settings.priorityTargets }}</span></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-priorityTargets"><input id="settings-priorityTargets" type="checkbox" name="priorityTargets"></label></td></tr></tbody></table><h5 class="twx-section">{{ this.settings.filters }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="icon-26x26-double-arrow"></span> <span class="ff-cell-fix">{{ this.settings.minDistance }}</span></td><td><input name="minDistance" type="number" class="textfield-border" min="0" max="60" required></td></tr><tr><td><span class="icon-26x26-double-arrow"></span> <span class="ff-cell-fix">{{ this.settings.maxDistance }}</span></td><td><input name="maxDistance" type="number" class="textfield-border" min="1" max="60" required></td></tr><tr><td><span class="icon-34x34-points-per-village"></span> <span class="ff-cell-fix">{{ this.settings.minPoints }}</span></td><td><input name="minPoints" type="number" class="textfield-border" required></td></tr><tr><td><span class="icon-34x34-points-per-village"></span> <span class="ff-cell-fix">{{ this.settings.maxPoints }}</span></td><td><input name="maxPoints" type="number" class="textfield-border" required></td></tr><tr><td><span class="icon-26x26-time"></span> <span class="ff-cell-fix">{{ this.settings.maxTravelTime }}</span></td><td><input name="maxTravelTime" type="text" class="textfield-border" pattern="\\\\d{1,2}:\\\\d{1,2}:\\\\d{1,2}" required></td></tr></tbody></table><h5 class="twx-section">{{ this.settings.security }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="ff-cell-fix">{{ this.settings.randomBase }}</span></td><td><input name="randomBase" type="number" class="textfield-border" min="0" required></td></tr><tr><td>{{ this.settings.ignoreOnLoss }}</td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-ignoreOnLoss"><input id="settings-ignoreOnLoss" type="checkbox" name="ignoreOnLoss"></label></td></tr></tbody></table><h5 class="twx-section">{{ this.settings.events }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="icon-26x26-info"></span> <span class="ff-cell-fix">{{ this.settings.eventsLimit }}</span></td><td><input name="eventsLimit" type="number" class="textfield-border" min="1" required></td></tr><tr><td>{{ this.settings.eventAttack }}</td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-eventAttack"><input id="settings-eventAttack" type="checkbox" name="eventAttack"></label></td></tr><tr><td>{{ this.settings.eventVillageChange }}</td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-eventVillageChange"><input id="settings-eventVillageChange" type="checkbox" name="eventVillageChange"></label></td></tr><tr><td>{{ this.settings.eventPriorityAdd }}</td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-eventPriorityAdd"><input id="settings-eventPriorityAdd" type="checkbox" name="eventPriorityAdd"></label></td></tr><tr><td>{{ this.settings.eventIgnoredVillage }}</td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-eventIgnoredVillage"><input id="settings-eventIgnoredVillage" type="checkbox" name="eventIgnoredVillage"></label></td></tr></tbody></table><h5 class="twx-section">{{ this.settings.others }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="icon-26x26-message-misc"></span> <span class="ff-cell-fix">{{ this.settings.remote }}</span></td><td><input name="remoteId" type="text" class="textfield-border" min="3" max="45"></td></tr><tr><td>{{ this.settings.hotkeySwitch }}</td><td><input name="hotkeySwitch" type="text" class="textfield-border"></td></tr><tr><td>{{ this.settings.hotkeyWindow }}</td><td><input name="hotkeyWindow" type="text" class="textfield-border"></td></tr><tr><td><span class="icon-34x34-general"></span> <span class="ff-cell-fix">{{ this.settings.language }}</span></td><td><select name="language" id="autofarm-language"><option value="en_us">English</option><option value="pt_br">Português</option></select></td></tr></tbody></table><br><div class="center"><input class="btn-orange btn-border" id="autofarm-save" type="submit" value="{{ this.settings.save }}"></div></form></div><div class="box-paper footer has-footer-upper autofarm-content-log"><div class="screen-tribe-news rich-text"><h5 class="twx-section">{{ this.events.status }}</h5><table class="tbl-border-light tbl-news tbl-big-header"><colgroup><col width="135px"><col width="*"></colgroup><tbody><tr class="list-item"><td id="autofarm-status" colspan="2" class="cell-center">{{ this.events.paused }}</td></tr><tr class="reduced"><td>{{ this.events.selectedVillage }}</td><td id="autofarm-selected"></td></tr><tr class="reduced"><td>{{ this.events.lastAttack }}</td><td id="autofarm-last">{{ this.general.none }}</td></tr></tbody></table><h5 class="twx-section">{{ this.general.events }}</h5><table class="tbl-border-light tbl-news tbl-big-header"><colgroup><col width="125px"><col width="*"></colgroup><tbody id="autofarm-events"><tr class="reduced"><td class="tribe-event-detail" colspan="2"><div class="text-tribe-news"><span>{{ this.events.nothingYet }}</span></div></td></tr></tbody></table></div></div></div><footer class="win-foot"><ul class="list-btn list-center"><li><a class="btn-orange btn-border" id="autofarm-start">{{ this.general.start }}</a></li></ul></footer></div>',a);this.$window.innerHTML=c,this.$wrapper.append(this.$window);let d=document.createElement("div");d.id="autofarm-interface",d.innerHTML='<div class="btn-border btn-green button"><div class="top-left"></div><div class="top-right"></div><div class="middle-top"></div><div class="middle-bottom"></div><div class="middle-left"></div><div class="middle-right"></div><div class="bottom-left"></div><div class="bottom-right"></div><div class="text">Farm</div><div class="quickview"></div></div>',$("#toolbar-left").prepend(d),this.$scrollbar=jsScrollbar(this.$window.querySelector(".win-main")),this.$button=$(".button",d),this.$quickview=this.$button.find(".quickview"),this.$settings=$("#autofarm-settings"),this.$start=$("#autofarm-start"),this.$close=$("#autofarm-close"),this.$preset=$("#autofarm-preset"),this.$groupIgnore=$("#autofarm-ignore"),this.$groupInclude=$("#autofarm-include"),this.$groupOnly=$("#autofarm-only"),this.$language=$("#autofarm-language"),this.$events=$("#autofarm-events"),this.$status=$("#autofarm-status"),this.$last=$("#autofarm-last"),this.$selected=$("#autofarm-selected"),this.updateLastAttack(),this.updateSelectedVillage(),this.bindQuickview()},d.prototype.updateLastAttack=function(a){`${m.getId()}_autofarm_lastAttack`;if(a)Lockr.set("lastAttack",a);else if(!(a=Lockr.get("lastAttack")))return;let b=j("readableDateFilter")(a),c=this.autofarm.lang.events.lastAttack;this.$last.html(b),this.$quickview.html(c+": "+b)},d.prototype.updateSelectedVillage=function(){let a=this.autofarm.village;if(!a)return this.$selected.html(this.autofarm.lang.general.none),!1;let b=c("village",`${a.name} (${a.x}|${a.y})`,this.autofarm.village.id);this.$selected.html(""),this.$selected.append(b.elem)},d.prototype.bindQuickview=function(){let a=this.$button.find(".text"),b=this.autofarm.lang.events.lastAttack;this.$button.on("mouseenter",()=>{this.$button.addClass("autofarm-show-status");this.$button.removeClass("autofarm-hide-status");this.$quickview.html(`${b}: ${this.$last.html()}`);a.hide();this.$quickview.show()}),this.$button.on("mouseleave",()=>{this.$button.removeClass("autofarm-show-status");this.$button.addClass("autofarm-hide-status");this.$quickview.hide();a.show()})},d.prototype.openWindow=function(){i.closeAll(),this.$window.style.visibility="visible",this.$wrapper.addClass("window-open"),l.trigger(l.types.RESIZE,{instant:!0,right:!0})},d.prototype.closeWindow=function(){this.$window.style.visibility="hidden",this.$wrapper.removeClass("window-open"),l.trigger(l.types.RESIZE,{instant:!0,right:!0})},d.prototype.toggleWindow=function(a){this.$window.style.visibility=a,this.$wrapper.toggleClass("window-open"),l.trigger(l.types.RESIZE,{instant:!0,right:!0})},d.prototype.tabsState=function(){for(let a of this.$tabs){let b=a.getAttribute("tab"),c=this.$window.querySelector(`.autofarm-content-${b}`),d=a.querySelector(".tab-inner > div"),e=a.querySelector("a");this.activeTab===b?(c.style.display="",a.classList.add("tab-active"),d.classList.add("box-border-light"),e.classList.remove("btn-icon","btn-orange"),this.$scrollbar.content=c):(c.style.display="none",a.classList.remove("tab-active"),d.classList.remove("box-border-light"),e.classList.add("btn-icon","btn-orange")),this.$scrollbar.recalc()}},d.prototype.bindTabs=function(){this.$tabs=this.$window.querySelectorAll(".tab");for(let a of this.$tabs){let b=a.getAttribute("tab");a.addEventListener("click",()=>{this.activeTab=b;this.tabsState()})}this.tabsState()},d.prototype.eachSetting=function(a){for(let b in this.autofarm.settings){let c=$(`[name="${b}"]`,this.$window);c.length&&a(c)}},d.prototype.bindSettings=function(){this.eachSetting(a=>{let b=a[0].type;let c=a[0].name;if("select-one"===b)return void("language"===c&&(a[0].value=this.autofarm.settings.language));if("checkbox"===b)return this.autofarm.settings[c]&&(a[0].checked=!0,a.parent().addClass("icon-26x26-checkbox-checked")),void a.on("click",()=>{a.parent().toggleClass("icon-26x26-checkbox-checked")});a.val(this.autofarm.settings[c])}),this.$settings.on("submit",a=>{a.preventDefault();if(this.$settings[0].checkValidity()){let a={};this.eachSetting(b=>{let c=b[0].name;b[0].type;let d=b.val();"number"===b[0].type&&(d=parseInt(d,10));a[c]=d}),this.autofarm.updateSettings(a),e.$broadcast(g.MESSAGE_SUCCESS,{message:this.autofarm.lang.settings.saved})}})},d.prototype.addEvent=function(a,b){let c=parseInt(this.autofarm.settings.eventsLimit,10);this.eventCount>=c&&this.$events.find("tr:last-child").remove(),this.events.length>=c&&this.events.pop(),this.addRow(this.$events,a,b),this.eventCount++,b||(a.timestamp=Date.now(),this.events.unshift(a),Lockr.set("lastEvents",this.events))},d.prototype.addRow=function(d,e,f){let g=[];if(e=angular.copy(e),e.links){for(let a=0;a<e.links.length;a++)g.push(c(e.links[a].type,e.links[a].name));e.text=a(e.text,g)}let i=document.createElement("tr");if(i.className="reduced",i.innerHTML=b('<td class="tribe-event-time">{{ this.date }}</td><td class="tribe-event-detail"><span class="icon-bg-black icon-26x26-{{ this.icon }}"></span><div class="text-tribe-news"><span>{{ this.text }}</span></div></td>',{date:j("readableDateFilter")(e.timestamp||Date.now()),icon:e.icon,text:e.text}),e.icon||(i.querySelector(".icon-bg-black").remove(),i.querySelector(".text-tribe-news").className=""),e.links)for(let a=0;a<g.length;a++)e.links[a].elem=i.querySelector("#"+g[a].id),e.links[a].elem.addEventListener("click",function(){h.openVillageInfo(e.links[a].id)});d[f?"append":"prepend"](i),this.$scrollbar.recalc()},d.prototype.updatePresetList=function(){let a={},b=f.getPresetList().presets;this.$preset.html(`<option value="">${this.autofarm.lang.general.disabled}</option>`);for(let c in b){let d=b[c].name,e=d.replace(/(\(|\{|\[|\"|\')[^\)\}\]\"\']+(\)|\}|\]|\"|\')/,"").trim();if(!(e in a)){let b=this.autofarm.settings.presetName===e?"selected":"";this.$preset.append(`<option value="${e}" ${b}>${e}</option>`),a[e]=!0}}},d.prototype.updateGroupList=function(){let a=["groupIgnore","groupInclude","groupOnly"],b=f.getGroupList().getGroups();for(let c of a){let a="$"+c;this[a].html(`<option value="">${this.autofarm.lang.general.disabled}</option>`);for(let d in b){let e=b[d].name,f=this.autofarm.settings[c]===e?"selected":"";this[a].append(`<option value="${e}" ${f}>${e}</option>`)}}},d.prototype.bindEvents=function(){let a=this.autofarm.settings,b={sendCommand:(b,c)=>{this.$status.html(this.autofarm.lang.events.attacking);this.updateLastAttack(Date.now());if(!a.eventAttack)return!1;let d=`${b.name} (${b.x}|${b.y})`;let e=`${c.name} (${c.x}|${c.y})`;this.addEvent({links:[{type:"village",name:d,id:b.id},{type:"village",name:e,id:c.id}],text:this.autofarm.lang.events.sendCommand,icon:"attack-small"})},nextVillage:b=>{this.updateSelectedVillage();if(!a.eventVillageChange)return!1;let c=`${b.name} (${b.x}|${b.y})`;this.addEvent({links:[{type:"village",name:c,id:b.id}],icon:"village",text:this.autofarm.lang.events.nextVillage})},ignoredVillage:b=>{if(!a.eventIgnoredVillage)return!1;let c=`${b.name} (${b.x}|${b.y})`;this.addEvent({links:[{type:"village",name:c,id:b.id}],icon:"check-negative",text:this.autofarm.lang.events.ignoredVillage})},priorityTargetSelected:b=>{if(!a.eventPriorityAdd)return!1;let c=`${b.name} (${b.x}|${b.y})`;this.addEvent({links:[{type:"village",name:c,id:b.id}],icon:"parallel-recruiting",text:this.autofarm.lang.events.priorityTargetAdded})},noPreset:()=>{this.addEvent({icon:"info",text:this.autofarm.lang.events.noPreset});this.$status.html(this.autofarm.lang.events.paused)},noUnits:()=>{this.autofarm.singleVillage&&this.$status.html(this.autofarm.lang.events.noUnits)},noUnitsNoCommands:()=>{this.$status.html(this.autofarm.lang.events.noUnitsNoCommands)},start:()=>{this.$status.html(this.autofarm.lang.events.attacking)},pause:()=>{this.$status.html(this.autofarm.lang.events.paused)},noVillages:()=>{this.$status.html(this.autofarm.lang.events.noVillages)},villagesUpdate:()=>{this.updateSelectedVillage()},startLoadingTargers:()=>{this.$status.html(this.autofarm.lang.events.loadingTargets)},endLoadingTargers:()=>{this.$status.html(this.autofarm.lang.events.analyseTargets)},attacking:()=>{this.$status.html(this.autofarm.lang.events.attacking)},commandLimitSingle:()=>{this.$status.html(this.autofarm.lang.events.commandLimit)},commandLimitMulti:()=>{this.$status.html(this.autofarm.lang.events.noVillages)},restartingCommands:()=>{this.$status.html(this.autofarm.lang.events.restartingCommands)}};for(let a in b)this.autofarm.on(a,b[a])},d}(),Analytics=function(){let a=null,b=null,c=function(b){a||(a=b)},d=function(a){b||(b=a)};return{init:function(e){c(e),d(a.getWorldId()+"-"+a.getId()),ga("create","UA-92130203-3","auto","FarmOverflow"),ga("FarmOverflow.set","userId",b),ga("FarmOverflow.set","dimension1",a.getWorldId()),ga("FarmOverflow.set","dimension2",a.getRank()),ga("FarmOverflow.set","dimension3",a.getPoints()),ga("FarmOverflow.set","dimension4",a.getVillageList().length),ga("FarmOverflow.set","dimension5",a.getId()),ga("FarmOverflow.send","pageview")},attack:function(){if(!a)return!1;ga("FarmOverflow.send","event","commands","attack")},attackError:function(b){if(!a)return!1;ga("FarmOverflow.send","event","commands","attackError",b)},ignoreTarget:function(){if(!a)return!1;ga("FarmOverflow.send","event","commands","ignoreTarget")},priorityTarget:function(){if(!a)return!1;ga("FarmOverflow.send","event","commands","priorityTarget")},start:function(){if(!a)return!1;ga("FarmOverflow.send","event","behavior","start")},pause:function(){if(!a)return!1;ga("FarmOverflow.send","event","behavior","pause")},settingsChange:function(b){if(!a)return!1;ga("FarmOverflow.send","event","behavior","settingsChange",b)},villageChange:function(){if(!a)return!1;ga("FarmOverflow.send","event","behavior","villageChange")},remoteCommand:function(){if(!a)return!1;ga("FarmOverflow.send","event","behavior","remoteCommand")}}}(),function(){if("undefined"!=typeof __autofarm)return!1;__autofarm=!0;let a=function(){let a=injector.get("modelDataService"),b=a.getSelectedCharacter();Analytics.init(b),Lockr.prefix=`${b.getId()}_autofarm_`;let c=new FarmOverflow;new FarmOverflowInterface(c)},b=document.querySelector("#map");if(angular.element(b).scope().isInitialized)a();else{let b=angular.element(document).scope(),c=injector.get("eventTypeProvider");b.$on(c.MAP_INITIALIZED,a)}}();
//# sourceMappingURL=tw2autofarm.map