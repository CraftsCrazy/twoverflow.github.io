/*! tw2autofarm.min.js@1.3.3 */
function AutoFarm(a={}){return log("AutoFarm"),this.version="1.3.3",this.defaults={maxDistance:10,minDistance:0,maxTravelTime:"01:00:00",randomBase:3,presetName:"",groupIgnore:"",groupInclude:"",groupOnly:"",minPoints:0,maxPoints:12500,eventsLimit:20,ignoreOnLoss:!0,language:"",keepRunningLoopTime:3e5,keepRunningTolerance:3e5,indexExpire:18e5},this.settings=angular.merge({},this.defaults,a),this.villages=null,this.running=!1,this.uniqueVillage=null,this.selectedVillage=null,this.targets={},this.returningTimes={},this.commandProgressId=null,this.commandProgressCallback=null,this.eventListeners={},this.eventsEnabled=!0,this.presets=[],this.groupIgnore=null,this.ignoredVillages=[],this.groupInclude=null,this.includedVillages=[],this.groupOnly=null,this.nextCommandTime=null,this.keepRunningId=null,this.indexes=null,this.updateExceptionGroups(),this.updateExceptionVillages(),this.updatePlayerVillages(),this.updatePresets(),this.updateIndexes(),this.listeners(),this.languages(),this}function log(){__debug&&console.log.apply(this,arguments)}function AutoFarmInterface(a){return this.autofarm=a,this.newSettings={},this.activeTab="info",this.eventCount=1,this.buildStyle(),this.buildWindow(),this.bindTabs(),this.bindSettings(),this.bindEvents(),this.updateGroupList(),a.updatePresets(()=>{this.updatePresetList()}),this.$close.on("click",()=>{this.closeWindow()}),hotkeys.add("esc",()=>{this.closeWindow()},["INPUT","SELECT","TEXTAREA"]),$rootScope.$on(eventTypeProvider.WINDOW_CLOSED,()=>{this.closeWindow()}),this.$button.on("click",()=>{this.openWindow()}),hotkeys.add("z",()=>{this.openWindow()}),this}if($rootScope=angular.element(document).scope(),modelDataService=injector.get("modelDataService"),socketService=injector.get("socketService"),routeProvider=injector.get("routeProvider"),eventTypeProvider=injector.get("eventTypeProvider"),armyService=injector.get("armyService"),presetList=modelDataService.getPresetList(),math=require("helper/math"),conf=require("conf/conf"),convert=require("helper/mapconvert"),mapData=require("struct/MapData"),__debug=!1,rPresetName=/(\(|\{|\[|\"|\')[^\)\}\]\"\']+(\)|\}|\]|\"|\')/,AutoFarm.prototype.start=function(){return this.presets.length?(this.running=!0,this.event("start"),this.command(),this.keepRunning(),!0):(this.event("noPreset"),!1)},AutoFarm.prototype.pause=function(){return this.running=!1,this.event("pause"),clearTimeout(this.commandTimerId),clearTimeout(this.keepRunningId),this.commandTimerId=!1,this.keepRunningId=!1,!0},AutoFarm.prototype.keepRunning=function(){clearInterval(this.keepRunningId);let a=parseInt(this.settings.keepRunningLoopTime,10),b=parseInt(this.settings.keepRunningTolerance,10);this.keepRunningId=setInterval(()=>{log("keepRunning");if(!this.nextCommandTime)return!1;let a=Date.now()-this.nextCommandTime;a>b&&(this.nextCommandTime=null,this.command())},a)},AutoFarm.prototype.updateSettings=function(a){log("updateSettings");let b={};a.groupIgnore!==this.settings.groupIgnore&&(b.groups=!0),a.groupInclude!==this.settings.groupInclude&&(b.groups=!0,b.targets=!0),a.groupOnly!==this.settings.groupOnly&&(b.groups=!0,b.villages=!0,b.targets=!0),a.presetName!==this.settings.presetName&&(b.preset=!0),a.minDistance!==this.settings.minDistance&&(b.targets=!0),a.maxDistance!==this.settings.maxDistance&&(b.targets=!0),a.minPoints!==this.settings.minPoints&&(b.targets=!0),a.maxPoints!==this.settings.maxPoints&&(b.targets=!0);for(let b in a)this.settings[b]=a[b];b.groups&&(this.updateExceptionGroups(),this.updateExceptionVillages()),b.villages&&this.updatePlayerVillages(),b.preset&&this.updatePresets(),b.targets&&(this.targets={}),this.disableEvents(),this.running&&(this.pause(),this.start()),this.enableEvents()},AutoFarm.prototype.disableEvents=function(){log("disableEvents"),this.eventsEnabled=!1},AutoFarm.prototype.enableEvents=function(){log("enableEvents"),this.eventsEnabled=!0},AutoFarm.prototype.nextTarget=function(a,b=0){log("nextTarget");let c=this.selectedVillage.getId();if(!this.targets.hasOwnProperty(c))return void this.command();let d=this.targets[c];a||this.indexes[c]++;let e=this.indexes[c];d[e]?this.selectedTarget=d[e]:(this.selectedTarget=d[0],this.indexes[c]=0),this.saveIndexes();let f=this.selectedTarget;return this.ignoredVillages.includes(f.id)?b===d.length?this.event("noTargets"):(this.event("ignoredTarget",[f]),this.nextTarget(!1,++b)):(a||this.event("nextTarget",[this.selectedTarget]),!0)},AutoFarm.prototype.checkTarget=function(){return log("checkTarget"),this.nextTarget(!0)},AutoFarm.prototype.getTargets=function(a){log("getTargets");let b=this.selectedVillage.getPosition(),c=this.selectedVillage.getId();if(c in this.targets)return a();let d=conf.MAP_CHUNK_SIZE,e=b.x-d,f=b.y-d,g=2*d,h=2*d,i=()=>{let a=mapData.hasTownDataInChunk(e,f);if(a)j();else{this.event("startLoadingTargers");let a=convert.scaledGridCoordinates(e,f,g,h,d),b=a.length,c=0;mapData.loadTownDataAsync(e,f,g,h,()=>{++c===b&&(this.event("endLoadingTargers"),j())})}return},j=()=>{let a=mapData.loadTownData(e,f,g,h,d);let b=a.length;for(;b--;){let c=a[b],d=c.data;for(let a in d){let b=d[a];for(let a in b){let c=b[a];l(c)}}}m()},k=[],l=a=>{if(a.id<0||a.id===c)return;if(a.attack_protection)return;if(!this.includedVillages.includes(a.id)&&a.character_id)return;if(a.points<this.settings.minPoints)return;if(a.points>this.settings.maxPoints)return;let d=math.actualDistance(b,a);if(d<this.settings.minDistance)return;if(d>this.settings.maxDistance)return;k.push({coords:[a.x,a.y],distance:d,id:a.id,name:a.name,pid:a.character_id})},m=()=>{if(0===k.length){let b=this.nextVillage();return b?this.getTargets(a):this.event("noTargets"),!1}this.targets[c]=k.sort(function(a,b){return a.distance-b.distance});void 0===this.indexes[c]&&(this.indexes[c]=0,this.saveIndexes());this.selectedTarget=this.targets[c][0];a()};return i()},AutoFarm.prototype.nextVillage=function(a=0){if(log("nextVillage"),this.uniqueVillage)return!1;if(a===this.villages.length)return this.event("noVillages"),!1;let b=this.villages.indexOf(this.selectedVillage)+1;return this.selectedVillage=void 0!==this.villages[b]?this.villages[b]:this.villages[0],this.ignoredVillages.includes(this.selectedVillage.getId())?this.nextVillage(++a):this.selectedVillage.getId()in this.returningTimes?this.nextVillage(++a):(this.event("nextVillage",[this.selectedVillage]),!0)},AutoFarm.prototype.selectVillage=function(a){log("selectVillage");let b=this.villages.indexOf(a);return-1!==b&&(this.selectedVillage=this.villages[b],this.firstFirstTarget(),!0)},AutoFarm.prototype.updateIndexes=function(){log("updateIndexes");let a=`${player.getId()}_autofarm_indexes`,b=localStorage[a];if(!b)return void(this.indexes={});this.indexes=JSON.parse(b);let c=this.indexes.last;Date.now()-c>parseInt(this.settings.indexExpire,10)&&(localStorage.removeItem(a),this.indexes={})},AutoFarm.prototype.saveIndexes=function(){log("saveIndexes");let a=`${player.getId()}_autofarm_indexes`;this.indexes.last=Date.now(),localStorage[a]=JSON.stringify(this.indexes)},AutoFarm.prototype.event=function(a,b){if(log("event",a),!this.eventsEnabled)return this;if(a in this.eventListeners){let c=this.eventListeners[a];for(let a=0;a<c.length;a++)c[a].apply(this,b)}return this},AutoFarm.prototype.on=function(a,b){return log("on",a),"function"==typeof b&&(a in this.eventListeners||(this.eventListeners[a]=[]),this.eventListeners[a].push(b)),this},AutoFarm.prototype.presetAvail=function(a){log("presetAvail");let b=!1;for(let c of this.presets){let d=!0;for(let b in c.units)a[b].in_town<c.units[b]&&(d=!1);if(d){if(this.presetTimeAvail(c))return c;b=!0}else;}return{error:b?"timeLimit":"noUnits"}},AutoFarm.prototype.presetTimeAvail=function(a){log("presetTimeAvail");let b=AutoFarm.time2seconds(this.settings.maxTravelTime),c=this.selectedVillage.getPosition(),d={x:this.selectedTarget.coords[0],y:this.selectedTarget.coords[1]},e=math.actualDistance(c,d),f=armyService.calculateTravelTime(a,{barbarian:!this.selectedVillage.pid,officers:!1});return b>armyService.getTravelTimeForDistance(a,f,e,"attack")},AutoFarm.time2seconds=function(a){return log("time2seconds"),a=a.split(":"),a[0]=60*parseInt(a[0],10)*60,a[1]=60*parseInt(a[1],10),a[2]=parseInt(a[2],10),a.reduce((a,b)=>a+b)},AutoFarm.prototype.getVillageCommands=function(a){log("getVillageCommands");let b=this.selectedVillage.getId();if(CommandController.hasCommandSet(b))return a();socketService.emit(routeProvider.GET_OWN_COMMANDS,{village_id:b},(c,d)=>{if("Command/ownCommands"!==d)return this.getVillageCommands(a);CommandController.newCommandSet(b,c.commands);a()})},AutoFarm.prototype.getVillageUnits=function(a){log("getVillageUnits"),socketService.emit(routeProvider.VILLAGE_UNIT_INFO,{village_id:this.selectedVillage.getId()},b=>{a(b.available_units)})},AutoFarm.prototype.updatePresets=function(a){log("updatePresets");let b=b=>{this.presets=[];for(let a in b)if(b.hasOwnProperty(a)){let c=b[a].name,d=c.replace(rPresetName,"").trim();d===this.settings.presetName&&(b[a].cleanName=d,b[a].units=AutoFarm.cleanPresetUnits(b[a].units),this.presets.push(b[a]))}a&&a()};presetList.isLoaded()?b(presetList.presets):socketService.emit(routeProvider.GET_PRESETS,{},a=>{b(a.presets)})},AutoFarm.prototype.assignPresets=function(a,b){log("assignPresets"),socketService.emit(routeProvider.ASSIGN_PRESETS,{village_id:this.selectedVillage.getId(),preset_ids:a},b)},AutoFarm.prototype.checkPresets=function(a){log("checkPresets");let b=this.selectedVillage.getId(),c=presetList.getPresetsByVillageId(b),d=!1,e=[];for(preset of this.presets)c.hasOwnProperty(preset.id)||(d=!0,e.push(preset.id));if(d){for(let a in c)e.push(a);this.assignPresets(e,a)}else a()},AutoFarm.cleanPresetUnits=function(a){log("cleanPresetUnits");let b={};for(let c in a)a[c]>0&&(b[c]=a[c]);return b},AutoFarm.prototype.updateExceptionGroups=function(){log("updateExceptionGroups");let a=["groupIgnore","groupInclude","groupOnly"],b=modelDataService.getGroupList().getGroups();for(let c of a){this[c]=null;for(let a in b){let d=b[a];if(d.name===this.settings[c]){this[c]={name:d.name,id:d.id};break}}}},AutoFarm.prototype.updateExceptionVillages=function(){log("updateExceptionVillages");let a=modelDataService.getGroupList();this.ignoredVillages=[],this.includedVillages=[],this.groupIgnore&&(this.ignoredVillages=a.getGroupVillageIds(this.groupIgnore.id)),this.groupInclude&&(this.includedVillages=a.getGroupVillageIds(this.groupInclude.id))},AutoFarm.prototype.updatePlayerVillages=function(){let a=player.getVillageList();if(this.groupOnly){let b=modelDataService.getGroupList(),c=b.getGroupVillageIds(this.groupOnly.id);this.villages=a.filter(a=>c.includes(a.getId())),this.uniqueVillage=1===this.villages.length,this.selectedVillage=this.villages[0]}else this.villages=a,this.uniqueVillage=1===a.length,this.selectedVillage=a[0];this.event("playerVillagesUpdate")},AutoFarm.prototype.ignoreVillage=function(a){if(!this.groupIgnore)return!1;socketService.emit(routeProvider.GROUPS_LINK_VILLAGE,{group_id:this.groupIgnore.id,village_id:a.id},()=>{this.event("ignoredVillage",[a])})},AutoFarm.prototype.targetExists=function(a){for(let b in this.targets){let c=this.targets[b];for(let b=0;b<c.length;b++){let d=c[b];if(d.id===a)return d}}return!1},AutoFarm.prototype.listeners=function(){log("listeners");let a=()=>{this.updatePresets();this.event("presetsChange");this.presets.length||this.running&&(this.event("noPreset"),this.pause())},b=(a,b)=>{this.updateExceptionGroups();this.updateExceptionVillages();this.event("groupsChanged")},c=(a,b)=>{this.commandProgressId===b.target.id&&(this.commandProgressCallback(b),this.commandProgressCallback=null,this.commandProgressId=null);CommandController.hasCommandSet(b.origin.id)&&CommandController.setCommand(b.id,b.origin.id,b)},d=(a,b)=>{CommandController.hasCommandSet(b.origin.id)&&CommandController.removeCommand(b.command_id,b.origin.id)},e=(a,b)=>{if(!this.groupInclude)return!1;this.groupInclude.id===b.group_id&&(this.targets={})},f=(a,b)=>{if(!this.settings.ignoreOnLoss)return!1;if("attack"!==b.type)return!1;socketService.emit(routeProvider.REPORT_GET,{id:b.id},a=>{let b=a.ReportAttack;if(b.attCharacterId!==player.getId())return!1;let c=this.targetExists(b.defVillageId);if(!c)return!1;let d=b.attLosses;for(let a in d)if(d[a]>0)return this.ignoreVillage(c),!1});socketService.emit(routeProvider.REPORT_MARK_UNREAD,{reports:[b.id]},function(){})};$rootScope.$on(eventTypeProvider.COMMAND_SENT,c),$rootScope.$on(eventTypeProvider.COMMAND_RETURNED,d),$rootScope.$on(eventTypeProvider.ARMY_PRESET_UPDATE,a),$rootScope.$on(eventTypeProvider.ARMY_PRESET_DELETED,a),$rootScope.$on(eventTypeProvider.GROUPS_UPDATED,b),$rootScope.$on(eventTypeProvider.GROUPS_CREATED,b),$rootScope.$on(eventTypeProvider.GROUPS_DESTROYED,b),$rootScope.$on(eventTypeProvider.GROUPS_VILLAGE_LINKED,e),$rootScope.$on(eventTypeProvider.GROUPS_VILLAGE_UNLINKED,e),$rootScope.$on(eventTypeProvider.REPORT_NEW,f),mapData.setRequestFn(function(a){socketService.emit(routeProvider.MAP_GETVILLAGES,a)})},AutoFarm.prototype.command=function(){if(__debug&&(console.groupEnd("command"),console.group("command")),!this.running)return!1;if(!this.selectedVillage)return this.event("noVillageSelected"),!1;let a=this.selectedVillage.getId();if(!this.targets.hasOwnProperty(a))return this.getTargets(()=>{let a=this.checkTarget();a||this.nextVillage();this.command()}),!1;if(this.checkTarget(),this.returningTimes.hasOwnProperty(a)){let b=this.nextVillage();return b?this.command():(CommandController.checkCommandLimit(a)?this.event("commandLimit"):this.event("noUnits"),this.commandNextReturn()),!1}if(this.ignoredVillages.includes(a)){let a=this.nextVillage();return a&&this.command(),!1}let b=()=>{if(CommandController.checkCommandLimit(a)){if(this.event("commandLimit",[this.selectedVillage]),this.getNextReturn(),this.uniqueVillage){let b=this.returningTimes[a],c=1e3*AutoFarm.randomSeconds(5);this.commandTimerId=setTimeout(()=>{this.commandTimerId=!1;this.command()},b+c)}else this.command();return!1}this.getVillageUnits(c)},c=a=>{let b=this.presetAvail(a);if(b.error)return d(b.error);this.sendCommand(b,()=>{this.event("sendCommand",[this.selectedVillage,this.selectedTarget]);this.nextTarget();if(0==this.settings.randomBase)return this.command();let a=AutoFarm.randomSeconds(this.settings.randomBase);a*=1e3;this.commandTimerId=setTimeout(()=>{this.commandTimerId=!1;this.command()},a);this.event("nextCommandIn",[a])})},d=b=>{switch(b){case"timeLimit":this.nextTarget(),this.command();break;case"noUnits":if(this.event("noUnits",[this.selectedVillage]),this.getNextReturn(),this.uniqueVillage){if(!CommandController.countCommands(a))return this.event("noUnitsNoCommands");let b=this.getNeabyCommand();this.commandTimerId=setTimeout(()=>{this.commandTimerId=!1;this.command()},b),this.nextCommandTime=Date.now()+b}else{if(!this.nextVillage())return this.commandNextReturn();this.command()}}};this.checkPresets(()=>{this.getVillageCommands(b)})},AutoFarm.prototype.getNextReturn=function(){log("getNextReturn");let a=this.selectedVillage.getId(),b=this.getNeabyCommand();return this.returningTimes[a]=b,setTimeout(()=>{delete this.returningTimes[a];this.event("commandReturn",[a])},b),!0},AutoFarm.prototype.sendCommand=function(a,b){return log("sendCommand"),this.simulate(),!!this.running&&(socketService.emit(routeProvider.SEND_PRESET,{start_village:this.selectedVillage.getId(),target_village:this.selectedTarget.id,army_preset_id:a.id,type:"attack"}),this.commandProgressId=this.selectedTarget.id,this.commandProgressCallback=b,!0)},AutoFarm.prototype.commandNextReturn=function(){log("commandNextReturn");let a=this.nextVillageUnits();return this.commandTimerId=setTimeout(()=>{this.commandTimerId=!1;this.selectVillage(a.vid);this.command()},a.time),this.nextCommandTime=Date.now()+a.time,!0},AutoFarm.prototype.nextVillageUnits=function(){log("nextVillageUnits");let a=[];for(let b in this.returningTimes)a.push({vid:b,time:this.returningTimes[b]});return a.sort((a,b)=>a.time-b.time),a[0]},AutoFarm.prototype.getNeabyCommand=function(){log("getNeabyCommand");let a=(new Date).getTime()/1e3,b=[],c=this.selectedVillage.getId();return CommandController.eachCommand(c,function(c){if("support"!==c.type||"forward"!==c.direction){let d=c.time_completed-c.time_start,e=c.time_completed-a;"forward"===c.direction&&(e+=d),b.push(e)}}),b.sort((a,b)=>a-b),Math.round(1e3*b[0]+5e3)},AutoFarm.randomSeconds=function(a,b){log("randomSeconds"),a=parseInt(a,10);let c,d;return b?(c=a+b,d=a-b):(c=a+a/2,d=a-a/2),Math.round(Math.random()*(c-d)+d)},AutoFarm.prototype.simulate=function(a){log("simulate");let b=()=>{socketService.emit(routeProvider.GET_ATTACKING_FACTOR,{target_id:this.selectedTarget.id})};()=>{socketService.emit(routeProvider.PREMIUM_LIST_SHOP_OFFERS,{})};b(),a&&a()},AutoFarm.prototype.languages=function(){log("languages");let a={pt_br:{title:"Farmador Automático",events:{attacking:"Atacando.",commandLimit:"Limite de 50 ataques atingido, aguardando retorno.",lastAttack:"Último ataque",nextVillage:"Alternando para a aldeia {0}",noPreset:"Nenhuma predefinição disponível.",noSelectedVillage:"Nenhuma aldeia disponível.",noUnits:"Sem unidades na aldeia, aguardando ataques retornarem.",noUnitsNoCommands:"Nenhuma aldeia tem tropas nem ataques retornando.",noVillages:"Nenhuma aldeia disponível, aguardando ataques retornarem.",nothingYet:"Nada por aqui ainda...",paused:"Pausado.",presetFirst:"Configure uma predefinição primeiro!",selectedVillage:"Aldeia selecionada",sendCommand:"{0} ataca {1}",status:"Status",loadingTargets:"Carregando alvos...",checkingTargets:"Checando alvos..."},general:{disabled:"Desativado",events:"Eventos",info:"Informações",none:"Nenhum",pause:"Pausar",paused:"AutoFarm pausado.",settings:"Configurações",start:"Iniciar",started:"AutoFarm iniciado."},info:{development:["Desenvolvimento","AutoFarm é desenvolvido com <strong style='color:#ad0202'>❤</strong> por"],groupOnly:["Usando apenas aldeias de um grupo para atacar","Você pode selecionar um grupo especifico para usar apenas as aldeias desse grupo para enviar os ataques."],ignore:["Ignorando aldeias com grupo","Você pode selecionar um grupo nas configurações para que todas aldeias atribuidas a esse grupo sejam ignorados pelo AutoFarm. <strong>O grupo serve tanto para os alvos quanto para suas aldeias</strong>."],include:["Incluindo alvos com grupo","Assim como ignorar aldeias, você pode incluir como alvos aldeias de jogadores. Todas aldeias do grupo que estiverem fora da distância máxima não seram incluidas."],presets:["Configurando predefinições","O script utiliza predefinições para enviar os ataques, então é preciso que você selecione uma na aba de configurações.","As predefinição que não estiverem ativadas nas aldeias serão ativadas automaticamente.","Atenção! Se as predefinições tiverem <strong>oficiais</strong>, eles <strong>serão utilizados</strong>.","É possível utilizar mais de uma predefinição, <strong>desde que tenham uma mesma identificação</strong>.","É permitido adicionar uma descrição em conjunto com a identificação da predefinição. A descrição deve estar no final do nome e entre chaves, colchetes, parênteses, aspas ou aspas-simples.",'Exemplo de alguns nome de predefinições: <span>Farm (Lanças)</span> — <span>Farm "CL"</span> — <span>Farm {AM}</span>',"O script sempre tentará enviar a primeira predefinição da lista. Se a aldeia não possuír o mínimo exigido, então irá tentar a próxima."],randomBase:["Base do intervalo aleatório","Esse intervalo é usado para gerar um tempo aleatório (em segundos) entre cada ataque evitando o script ser detectado. <strong>Quanto maior melhor</strong>."],ignoreOnLoss:["Ignorando alvos que causam percas","Qualquer ataque que tenha causado alguma perca nas suas tropas será ignorado em ataques futuros.",'<strong>Atenção</strong>: Para essa funcionalidade funcionar é preciso ter a opção "Ignorando aldeias com grupo" configurada.','Todas aldeias que forem ignoradas será avisado na aba "Avisos".']},settings:{basicSettings:"Configurações Básicas",eventsLimit:"Número máximo de registros",groupIgnore:"Ignorar aldeias do grupo",groupInclude:"Incluir alvos do grupo",groupOnly:"Atacar apenas com aldeias do grupo",language:"Linguagem da interface (requer reinício)",maxDistance:"Distância máxima dos alvos",maxTravelTime:"Tempo máximo de viagem (ida)",minDistance:"Distância mínima dos alvos",others:"Outros",presetName:"Predefinição das tropas",randomBase:"Base do intervalo aleatório (segundos)",ignoreOnLoss:"Ignorar aldeias que causarem perdas",save:"Salvar configurações",saved:"Configurações salvas!",filters:"Filtros",presets:"Predefinições",villages:"Aldeias",security:"Segurança",minPoints:"Pontuação mínima dos alvos",maxPoints:"Pontuação máxima dos alvos"}},en_us:{title:"Auto Farm",events:{attacking:"Attacking.",commandLimit:"Limit of 50 attacks reached, waiting return.",lastAttack:"Last attack",nextVillage:"Changing to village {0}",noPreset:"No presets avaliable.",noSelectedVillage:"No villages avaliable.",noUnits:"No units avaliable in village, waiting attacks return.",noUnitsNoCommands:"No villages has units or commands returning.",noVillages:"No villages avaliable, waiting attacks return.",nothingYet:"Nothing available yet...",paused:"Paused.",presetFirst:"Set a preset first!",selectedVillage:"Village selected",sendCommand:"{0} attack {1}",status:"Status",loadingTargets:"Loading targets...",checkingTargets:"Checking targets..."},general:{disabled:"Disabled",events:"Task Logs",info:"Information",none:"None",pause:"Pause",paused:"AutoFarm paused.",settings:"Settings",start:"Start",started:"AutoFarm started."},info:{development:["Development","AutoFarm is developed with <strong style='color:#ad0202'>❤</strong> by"],groupOnly:["Using only villages from a group to attack","You can select a specific group to use only the villages from that group to attack."],ignore:["Ignoring Villages from a group","You can select a ignoring group from Presets Settings, all villages that assigned in that group will be ignored by the script. <strong>The group works on targets and your own villages as well</strong>."],include:["Including targets with a group","As well as ignoring villages, you can include village targets of players. All villages out of maximum distance will be ignored."],presets:["Setting presets","The script use presets to send attacks, you have to select one preset in the selection tab.","The preset that hasn't assigned to the villages will be automatically.","Attention! If the presets have <strong>officers</strong>, they <strong>will be used</strong>.","It's possible to have more than one preset, <strong>since it has the same identification</strong>.","Is permitted include some description along side the identification. The description must be between keys, brackets, parentheses, single or double quotes.",'Exemples of some preset names: <span>Farm (Spears)</span> — <span>Farm "LC"</span> — <span>Farm {MA}</span>',"The script will send the first preset from the list. If the village dosen't have enough troops, the script will select the next preset."],randomBase:["Random interval base","That interval is a random period of time (in seconds) between each attack avoid the script to be detected by the game. <strong>The bigger the better</strong>."],ignoreOnLoss:["Ignoring targets that cause loss","This option will ignore any target that cause loss in your troops.","The target that cause any loss to your troops will be ignored in the future.",'<strong>Note</strong>: For this feature works properly, the option "Ignore villages from group" must be set.','All villages that are blocked will be warned in the tab "Warnings".']},settings:{basicSettings:"Basic Settings",eventsLimit:"Maximum length of events",groupIgnore:"Ignore villages from group",groupInclude:"Include targets from group",groupOnly:"Attack only with villages from group",language:"Interface language (require restart)",maxDistance:"Targets maximum distance",maxTravelTime:"Maximum travel time (going)",minDistance:"Targets minimum distance",others:"Others",presetName:"Preset of troops",randomBase:"Random interval base (seconds)",ignoreOnLoss:"Ignore villages that cause loss",save:"Save settings",saved:"Settings saved!",filters:"Filters",presets:"Presets",villages:"Villages",security:"Security",minPoints:"Targets minimum points",maxPoints:"Targets maximum points"}}},b=require("conf/locale").LANGUAGE,c={pt_pt:"pt_br",en_dk:"en_us"};if(b in c&&(b=c[b]),this.settings.language)this.lang=a[this.settings.language];else{let c=b in a?b:"en_us";this.lang=a[c],this.settings.language=c}},CommandController=function(){let a={},b=function(b){return!!a.hasOwnProperty(b)},c=function(c){return!!b(c)&&a[c]},d=function(c,d){if(b(c))throw new Error("Command set já foi configurado.");let e={};for(let a=0;a<d.length;a++)e[d[a].id]=d[a];return a[c]=e,!0},e=function(c,d){return!!b(d)&&!!a[d].hasOwnProperty(c)},f=function(b,c){return!!e(b,c)&&a[c][c]},g=function(b,c,d){return a[c][b]=d,!0},h=function(b,c){return delete a[c][b]},i=function(a){let b=0;return k(a,function(){b++}),b},j=function(a){if(!b(a))throw new Error("Aldeia não foi configurada");return i(a)>=50},k=function(c,d){if(!b(c))return!1;let e=a[c];for(let a in e)if(!1===d(e[a]))break;return!0};return{hasCommandSet:b,getCommandSet:c,newCommandSet:d,hasCommand:e,getCommand:f,setCommand:g,removeCommand:h,countCommands:i,checkCommandLimit:j,eachCommand:k,getNeabyCommand:function(a){let b=Date.now()/1e3,c=[];return k(a,function(d){let e=d.direction;if("support"!==d.type||"forward"!==e){let f=d.time_completed-d.time_start,g=d.time_completed-b;g<0||("forward"===e&&(g+=f),c.push({backTime:g,commandId:a}))}}),c.sort((a,b)=>a.backTime-b.backTime),c[0].villageId}}}(),windowDisplayService=injector.get("windowDisplayService"),windowManagerService=injector.get("windowManagerService"),eventQueue=require("queues/EventQueue"),$filter=injector.get("$filter"),hotkeys=injector.get("hotkeys"),AutoFarmInterface.prototype.buildStyle=function(){this.$style=document.createElement("style"),this.$style.type="text/css",this.$style.id="autofarm-style",this.$style.innerHTML='#interface-autofarm{position:relative;top:0;left:0;margin-bottom:10px}#interface-autofarm .button{white-space:nowrap;position:relative;top:0;left:0;width:60px;height:24px}#interface-autofarm .text{margin:5px 0;font-size:12px}#wrapper.window-open #interface-autofarm .button{left:720px}#autofarm-window{visibility:hidden}#autofarm-window p,#autofarm-window h3{color:#000}#autofarm-window p{margin:7px 0;text-align:center;padding:0 40px}#autofarm-window p span{background:rgba(141,87,44,0.2)}#autofarm-window input[type=text],#autofarm-window input[type=number]{width:100%}#autofarm-window select{width:100%;padding:0 0 0 5px;font-size:14px;border:1px solid #976543;height:28px;text-decoration:none;text-align:left;border-radius:2px;font-weight:600;font-family:"Trebuchet MS";color:white;box-shadow:0 0 0 1px #421f09 inset,0 0 0 2px #976543 inset,0 0 0 3px #421f09 inset,0 -1px 1px 4px rgba(215,181,144,0.7) inset,0 0 1px 5px rgba(0,0,0,0.4) inset;-webkit-appearance:none;-moz-appearance:none;outline:none;background-image:url(https://i.imgur.com/SlaWRrX.png),url(https://i.imgur.com/e2qKrmX.png);background-repeat:no-repeat,repeat;background-position:293px -3px,top left;background-color:#b28e68}#autofarm-window .center{text-align:center}#autofarm-window .reduced{height:30px}#autofarm-window .jackpot{border:1px solid #000;margin:0 0 1px 0;line-height:22px;height:24px;position:relative;color:#ffecd8;text-shadow:1px 1px 1px #000;box-shadow:inset 0 0 0 1px rgba(218,125,103,0.5);background:url(https://i.imgur.com/e2qKrmX.png),linear-gradient(270deg, #b5751d, #e6c740, #b5751d);background-size:600% 600%;-webkit-animation:promo-animated 13s ease infinite;-moz-animation:promo-animated 13s ease infinite;animation:promo-animated 13s ease infinite}#autofarm-window .jackpot:after,#autofarm-window .jackpot:before{top:0;position:absolute;content:" ";display:block;width:40px;height:24px;background-image:url(https://i.imgur.com/yRBriWy.png)}#autofarm-window .jackpot:after{background-position:top right;right:0}#autofarm-window .jackpot:before{background-position:top left;left:0}#autofarm-settings input[type="text"],#autofarm-settings input[type="number"],#autofarm-settings select{color:black}#autofarm-settings [class^="icon-"]{display:inline;margin:0 9px 0 0}#autofarm-settings .icon-34x34-preset,#autofarm-settings .icon-26x26-time,#autofarm-settings .icon-26x26-info,#autofarm-settings .icon-26x26-double-arrow{zoom:.6}#autofarm-settings .icon-20x20-queue-indicator-short,#autofarm-settings .icon-20x20-queue-indicator-long,#autofarm-settings .icon-20x20-favourite{vertical-align:0;margin:0 5px 0 0}#autofarm-settings .icon-34x34-preset,#autofarm-settings .icon-26x26-time{vertical-align:3px}#autofarm-settings .icon-26x26-double-arrow{vertical-align:4px}#autofarm-settings .icon-26x26-info{vertical-align:5px}#autofarm-settings .icon-34x34-points-per-village{zoom:.5;vertical-align:6px}#autofarm-settings td{text-align:center}#autofarm-save{color:white;width:180px;height:25px;margin:6px;line-height:24px;border:none}@keyframes autofarmShowStatus{0%{width:60px}100%{width:220px}}@keyframes autofarmHideStatus{0%{width:220px}100%{width:60px}}.autofarm-show-status{animation:autofarmShowStatus .1s forwards}.autofarm-hide-status{animation:autofarmHideStatus .1s forwards}@-webkit-keyframes promo-animated{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}@-moz-keyframes promo-animated{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}@keyframes promo-animated{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}',document.querySelector("head").appendChild(this.$style)},AutoFarmInterface.prototype.buildWindow=function(){this.$wrapper=$("#wrapper"),this.$window=document.createElement("section"),this.$window.id="autofarm-window",this.$window.className="autofarm-window twx-window screen left";let a=angular.merge({version:this.autofarm.version,author:{name:"Rafael Mafra",email:"mafrazzrafael@gmail.com",url:"https://github.com/mafrazz/"}
},this.autofarm.lang),b=AutoFarmInterface.TemplateEngine('<div class="win-content message-list-wrapper searchable-list ng-scope"><header class="win-head"><h2 class="ng-binding">{{ this.title }} <span class="small">v{{ this.version }}</span></h2><ul class="list-btn"><li><a href="#" id="autofarm-close" class="size-34x34 btn-red icon-26x26-close"></a></li></ul></header><div class="win-main"><div class="tabs tabs-bg"><div class="tabs-three-col"><div class="tab" tab="info"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange">{{ this.general.info }}</a></div></div></div><div class="tab" tab="settings"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange">{{ this.general.settings }}</a></div></div></div><div class="tab" tab="log"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange">{{ this.general.events }}</a></div></div></div></div></div><div class="box-paper footer has-footer-upper autofarm-content-info"><h5 class="twx-section">{{ this.info.presets[0] }}</h5><div><p>{{ this.info.presets[1] }}</p><p>{{ this.info.presets[2] }}</p><p>{{ this.info.presets[3] }}</p><p>{{ this.info.presets[4] }}</p><p>{{ this.info.presets[5] }}</p><p>{{ this.info.presets[6] }}</p><p>{{ this.info.presets[7] }}</p></div><h5 class="twx-section">{{ this.info.ignore[0] }}</h5><div><p>{{ this.info.ignore[1] }}</p></div><h5 class="twx-section">{{ this.info.include[0] }}</h5><div><p>{{ this.info.include[1] }}</p></div><h5 class="twx-section">{{ this.info.randomBase[0] }}</h5><div><p>{{ this.info.randomBase[1] }}</p></div><h5 class="twx-section">{{ this.info.groupOnly[0] }}</h5><div><p>{{ this.info.groupOnly[1] }}</p></div><h5 class="twx-section">{{ this.info.ignoreOnLoss[0] }}</h5><div><p>{{ this.info.ignoreOnLoss[1] }}</p><p>{{ this.info.ignoreOnLoss[2] }}</p><p>{{ this.info.ignoreOnLoss[3] }}</p></div><h5 class="twx-section">{{ this.info.development[0] }}</h5><div class="text-center"><p>{{ this.info.development[1] }} <a href="{{ this.author.url }}">{{ this.author.name }}</a> &lt;{{ this.author.email }}&gt;</p></div></div><div class="box-paper footer has-footer-upper autofarm-content-settings"><form id="autofarm-settings"><h5 class="twx-section">{{ this.settings.preset }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="icon-34x34-preset"></span> <span class="ff-cell-fix">{{ this.settings.presetName }}</span></td><td><select name="presetName" id="presetName"></select></td></tr></tbody></table><h5 class="twx-section">{{ this.settings.villages }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="icon-20x20-queue-indicator-short"></span> <span class="ff-cell-fix">{{ this.settings.groupIgnore }}</span></td><td><select name="groupIgnore" id="groupIgnore"></select></td></tr><tr><td><span class="icon-20x20-queue-indicator-long"></span> <span class="ff-cell-fix">{{ this.settings.groupInclude }}</span></td><td><select name="groupInclude" id="groupInclude"></select></td></tr><tr><td><span class="icon-20x20-favourite"></span> <span class="ff-cell-fix">{{ this.settings.groupOnly }}</span></td><td><select name="groupOnly" id="groupOnly"></select></td></tr></tbody></table><h5 class="twx-section">{{ this.settings.filters }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="icon-26x26-double-arrow"></span> <span class="ff-cell-fix">{{ this.settings.minDistance }}</span></td><td><input name="minDistance" type="number" class="textfield-border" min="0" max="25" required></td></tr><tr><td><span class="icon-26x26-double-arrow"></span> <span class="ff-cell-fix">{{ this.settings.maxDistance }}</span></td><td><input name="maxDistance" type="number" class="textfield-border" min="1" max="25" required></td></tr><tr><td><span class="icon-34x34-points-per-village"></span> <span class="ff-cell-fix">{{ this.settings.minPoints }}</span></td><td><input name="minPoints" type="number" class="textfield-border" required></td></tr><tr><td><span class="icon-34x34-points-per-village"></span> <span class="ff-cell-fix">{{ this.settings.maxPoints }}</span></td><td><input name="maxPoints" type="number" class="textfield-border" required></td></tr><tr><td><span class="icon-26x26-time"></span> <span class="ff-cell-fix">{{ this.settings.maxTravelTime }}</span></td><td><input name="maxTravelTime" type="text" class="textfield-border" pattern="\\\\d{1,2}:\\\\d{1,2}:\\\\d{1,2}" required></td></tr></tbody></table><h5 class="twx-section">{{ this.settings.security }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="ff-cell-fix">{{ this.settings.randomBase }}</span></td><td><input name="randomBase" type="number" class="textfield-border" min="0" required></td></tr><tr><td><span class="ff-cell-fix">{{ this.settings.ignoreOnLoss }}</span></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-ignoreOnLoss"><input id="settings-ignoreOnLoss" type="checkbox" name="ignoreOnLoss"></label></td></tr></tbody></table><h5 class="twx-section">{{ this.settings.others }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="icon-26x26-info"></span> <span class="ff-cell-fix">{{ this.settings.eventsLimit }}</span></td><td><input name="eventsLimit" type="number" class="textfield-border" min="1" required></td></tr><tr><td><span class="ff-cell-fix">{{ this.settings.language }}</span></td><td><select name="language" id="autofarm-language"><option value="en_us">English</option><option value="pt_br">Português</option></select></td></tr></tbody></table><br><div class="center"><input class="btn-orange btn-border" id="autofarm-save" type="submit" value="{{ this.settings.save }}"></div></form></div><div class="box-paper footer has-footer-upper autofarm-content-log"><div class="screen-tribe-news rich-text"><h5 class="twx-section">{{ this.events.status }}</h5><table class="tbl-border-light tbl-news tbl-big-header"><colgroup><col width="135px"><col width="*"></colgroup><tbody><tr class="list-item"><td id="autofarm-status" colspan="2" class="cell-center">{{ this.events.paused }}</td></tr><tr class="reduced"><td>{{ this.events.selectedVillage }}</td><td id="autofarm-selectedVillage"></td></tr><tr class="reduced"><td>{{ this.events.lastAttack }}</td><td id="autofarm-last">{{ this.general.none }}</td></tr></tbody></table><h5 class="twx-section">{{ this.general.events }}</h5><table class="tbl-border-light tbl-news tbl-big-header"><colgroup><col width="125px"><col width="*"></colgroup><tbody id="autofarm-events"><tr class="reduced"><td class="tribe-event-detail" colspan="2"><div class="text-tribe-news"><span>{{ this.events.nothingYet }}</span></div></td></tr></tbody></table></div></div></div><footer class="win-foot"><ul class="list-btn list-center"><li><a class="btn-orange btn-border" id="autofarm-start">{{ this.general.start }}</a></li></ul></footer></div>',a);this.$window.innerHTML=b,this.$wrapper.append(this.$window);let c=document.createElement("div");c.id="interface-autofarm",c.innerHTML='<div class="btn-border btn-green button"><div class="top-left"></div><div class="top-right"></div><div class="middle-top"></div><div class="middle-bottom"></div><div class="middle-left"></div><div class="middle-right"></div><div class="bottom-left"></div><div class="bottom-right"></div><div class="text">AutoFarm</div></div>',$("#toolbar-left").prepend(c),this.$button=$(".button",c),this.$scrollbar=jsScrollbar(this.$window.querySelector(".win-main")),this.$settings=$("#autofarm-settings"),this.$start=$("#autofarm-start"),this.$close=$("#autofarm-close"),this.$preset=$("#presetName"),this.$groupIgnore=$("#groupIgnore"),this.$groupInclude=$("#groupInclude"),this.$groupOnly=$("#groupOnly"),this.$language=$("#autofarm-language"),this.$events=$("#autofarm-events"),this.$status=$("#autofarm-status"),this.$last=$("#autofarm-last"),this.$selected=$("#autofarm-selectedVillage"),this.updateLastAttack(),this.updateSelectedVillage(),this.bindQuickview()},AutoFarmInterface.prototype.updateLastAttack=function(a){let b=`${player.getId()}_autofarm_lastAttack`;if(a)localStorage[b]=a;else if(!(a=localStorage[b]))return;a=parseInt(a,10),this.$last.html($filter("readableDateFilter")(a))},AutoFarmInterface.prototype.updateSelectedVillage=function(){let a=this.autofarm.selectedVillage;if(!a)return this.$selected.html(this.autofarm.lang.general.none),!1;let b=AutoFarmInterface.createButtonLink("village",`${a.getName()} (${a.getX()}|${a.getY()})`,this.autofarm.selectedVillage.getId());this.$selected.html(""),this.$selected.append(b.elem)},AutoFarmInterface.prototype.bindQuickview=function(){let a=this.$button.find(".text"),b=(this.autofarm.lang.events.status,this.autofarm.lang.events.lastAttack);this.$button.on("mouseenter",()=>{this.$button.addClass("autofarm-show-status");this.$button.removeClass("autofarm-hide-status");a.html(`${b}: ${this.$last.html()}`)}),this.$button.on("mouseleave",()=>{this.$button.removeClass("autofarm-show-status");this.$button.addClass("autofarm-hide-status");a.html("AutoFarm")})},AutoFarmInterface.prototype.openWindow=function(){windowManagerService.closeAll(),this.$window.style.visibility="visible",this.$wrapper.addClass("window-open"),eventQueue.trigger(eventQueue.types.RESIZE,{instant:!0,right:!0})},AutoFarmInterface.prototype.closeWindow=function(){this.$window.style.visibility="hidden",this.$wrapper.removeClass("window-open"),eventQueue.trigger(eventQueue.types.RESIZE,{instant:!0,right:!0})},AutoFarmInterface.prototype.tabsState=function(){for(let a of this.$tabs){let b=a.getAttribute("tab"),c=this.$window.querySelector(`.autofarm-content-${b}`),d=a.querySelector(".tab-inner > div"),e=a.querySelector("a");this.activeTab===b?(c.style.display="",a.classList.add("tab-active"),d.classList.add("box-border-light"),e.classList.remove("btn-icon","btn-orange"),this.$scrollbar.content=c):(c.style.display="none",a.classList.remove("tab-active"),d.classList.remove("box-border-light"),e.classList.add("btn-icon","btn-orange")),this.$scrollbar.recalc()}},AutoFarmInterface.prototype.bindTabs=function(){this.$tabs=this.$window.querySelectorAll(".tab");for(let a of this.$tabs){let b=a.getAttribute("tab");a.addEventListener("click",()=>{this.activeTab=b;this.tabsState()})}this.tabsState()},AutoFarmInterface.prototype.eachSetting=function(a){for(let b in this.autofarm.settings){let c=$(`[name="${b}"]`,this.$window);c.length&&a(c)}},AutoFarmInterface.prototype.bindSettings=function(){this.eachSetting(a=>{let b=a[0].type;let c=a[0].name;if("select-one"===b)return void("language"===c&&(a[0].value=this.autofarm.settings.language));if("checkbox"===b)return this.autofarm.settings[c]&&(a[0].checked=!0,a.parent().addClass("icon-26x26-checkbox-checked")),void a.on("click",()=>{a.parent().toggleClass("icon-26x26-checkbox-checked")});a.val(this.autofarm.settings[c])}),this.$settings.on("submit",a=>{a.preventDefault();if(this.$settings[0].checkValidity()){let a={};this.eachSetting(b=>{let c=b[0].name;a[c]=b.val()}),this.autofarm.updateSettings(a);let b=JSON.stringify(a);localStorage[`${player.getId()}_autofarm`]=b,$rootScope.$broadcast(eventTypeProvider.MESSAGE_SUCCESS,{message:this.autofarm.lang.settings.saved})}})},AutoFarmInterface.prototype.addEvent=function(a){this.eventCount>=this.autofarm.settings.eventsLimit&&this.$events.find("tr:last-child").remove(),this.addRow(this.$events,a),this.eventCount++},AutoFarmInterface.prototype.addRow=function(a,b){let c=[];if(b.links){for(let a=0;a<b.links.length;a++)c.push(AutoFarmInterface.createButtonLink(b.links[a].type,b.links[a].name));b.text=AutoFarmInterface.sprintf(b.text,c)}let d=document.createElement("tr");if(d.className="reduced",d.innerHTML=AutoFarmInterface.TemplateEngine('<td class="tribe-event-time">{{ this.date }}</td><td class="tribe-event-detail"><span class="icon-bg-black icon-26x26-{{ this.icon }}"></span><div class="text-tribe-news"><span>{{ this.text }}</span></div></td>',{date:$filter("readableDateFilter")(Date.now()),icon:b.icon,text:b.text}),b.icon||(d.querySelector(".icon-bg-black").remove(),d.querySelector(".text-tribe-news").className=""),b.links)for(let a=0;a<c.length;a++)b.links[a].elem=d.querySelector("#"+c[a].id),b.links[a].elem.addEventListener("click",function(){windowDisplayService.openVillageInfo(b.links[a].id)});a.prepend(d),this.$scrollbar.recalc()},AutoFarmInterface.prototype.updatePresetList=function(){let a={},b=modelDataService.getPresetList().presets;this.$preset.html(`<option value="">${this.autofarm.lang.general.disabled}</option>`);for(let c in b){let d=b[c].name,e=d.replace(rPresetName,"").trim();if(!(e in a)){let b=this.autofarm.settings.presetName===e?"selected":"";this.$preset.append(`<option value="${e}" ${b}>${e}</option>`),a[e]=!0}}},AutoFarmInterface.prototype.updateGroupList=function(){let a=["groupIgnore","groupInclude","groupOnly"],b=modelDataService.getGroupList().getGroups();for(let c of a){let a="$"+c;this[a].html(`<option value="">${this.autofarm.lang.general.disabled}</option>`);for(let d in b){let e=b[d].name,f=this.autofarm.settings[c]===e?"selected":"";this[a].append(`<option value="${e}" ${f}>${e}</option>`)}}},AutoFarmInterface.prototype.bindEvents=function(){let a={sendCommand:(a,b)=>{let c=`${a.getName()} (${a.getX()}|${a.getY()})`;let d=`${b.name} (${b.coords[0]}|${b.coords[1]})`;this.addEvent({links:[{type:"village",name:c,id:a.getId()},{type:"village",name:d,id:b.id}],text:this.autofarm.lang.events.sendCommand,icon:"attack-small"});this.$status.html(this.autofarm.lang.events.attacking);this.updateLastAttack(Date.now())},nextVillage:a=>{let b=`${a.getName()} (${a.getX()}|${a.getY()})`;this.addEvent({links:[{type:"village",name:b,id:a.getId()}],icon:"village",text:this.autofarm.lang.events.nextVillage});this.updateSelectedVillage()},noPreset:()=>{if(!this.autofarm.running)return!1;this.addEvent({icon:"info",text:this.autofarm.lang.events.noPreset});this.$status.html(this.autofarm.lang.events.paused)},commandLimit:()=>{this.autofarm.uniqueVillage&&this.$status.html(this.autofarm.lang.events.commandLimit)},noUnits:()=>{this.autofarm.uniqueVillage&&this.$status.html(this.autofarm.lang.events.noUnits)},noUnitsNoCommands:()=>{this.$status.html(this.autofarm.lang.events.noUnitsNoCommands)},start:()=>{this.$status.html(this.autofarm.lang.events.attacking)},pause:()=>{this.$status.html(this.autofarm.lang.events.paused)},noVillages:()=>{this.$status.html(this.autofarm.lang.events.noVillages)},playerVillagesUpdate:()=>{this.updateSelectedVillage()},startLoadingTargers:()=>{this.$status.html(this.autofarm.lang.events.loadingTargets)},endLoadingTargers:()=>{this.$status.html(this.autofarm.lang.events.analyseTargets)}};for(let b in a)this.autofarm.on(b,a[b])},AutoFarmInterface.createButtonLink=function(a,b,c){let d=Math.round(1e5*Math.random()),e=AutoFarmInterface.TemplateEngine('<a id="l{{ id }}" class="img-link icon-20x20-{{ icon }} btn btn-orange padded">{{ text }}</a>',{icon:a,text:b,id:d}),f=document.createElement("div");return f.innerHTML=e,f=f.firstChild,f.addEventListener("click",function(){windowDisplayService.openVillageInfo(c)}),{html:e,id:"l"+d,elem:f}},AutoFarmInterface.TemplateEngine=function(a,b){let c,d,e=/{{(.+?)}}/g,f="with(obj) { var r=[];\n",g=0,h=function(a,b){f+=b?a.match(/(^( )?(var|if|for|else|switch|case|break|{|}|;))(.*)?/g)?a+"\n":"r.push("+a+");\n":""!=a?'r.push("'+a.replace(/"/g,'\\"')+'");\n':""};for(;d=e.exec(a);)h(a.slice(g,d.index)),h(d[1],!0),g=d.index+d[0].length;h(a.substr(g,a.length-g)),f=(f+'return r.join(""); }').replace(/[\r\t\n]/g," ");try{c=new Function("obj",f).apply(b,[b])}catch(a){}return c},AutoFarmInterface.sprintf=function(a,b){return a.replace(/{(\d+)}/g,function(a,c){return void 0!==b[c].html?b[c].html:a})},"undefined"==typeof loadingAutofarm){loadingAutofarm=!0;let a=function(){let a=document.createElement("script");a.type="text/javascript",a.src="https://goo.gl/GtP7vc",document.body.appendChild(a),a.remove()},b=function(){player=modelDataService.getSelectedCharacter();let b;b=localStorage.getItem(`${player.getId()}_autofarm`),b=b?JSON.parse(b):{},af=new AutoFarm(b),ui=new AutoFarmInterface(af),af.on("start",function(){ui.$start.html(af.lang.general.pause),ui.$start.removeClass("btn-green").addClass("btn-red"),ui.$button.removeClass("btn-green").addClass("btn-red"),$rootScope.$broadcast(eventTypeProvider.MESSAGE_SUCCESS,{message:af.lang.general.started})}),af.on("pause",function(){ui.$start.html(af.lang.general.start),ui.$start.removeClass("btn-red").addClass("btn-green"),ui.$button.removeClass("btn-red").addClass("btn-green"),$rootScope.$broadcast(eventTypeProvider.MESSAGE_SUCCESS,{message:af.lang.general.paused})}),af.on("presetsChange",()=>{ui.updatePresetList()}),af.on("groupsChanged",()=>{ui.updateGroupList()});let c=function(){if(af.running)af.pause();else{if(!af.presets.length)return $rootScope.$broadcast(eventTypeProvider.MESSAGE_ERROR,{message:af.lang.events.presetFirst}),!1;if(!af.selectedVillage)return $rootScope.$broadcast(eventTypeProvider.MESSAGE_ERROR,{message:af.lang.events.noSelectedVillage}),!1;af.start()}};ui.$start.on("click",c),hotkeys.add("shift+z",c),a()},c=document.querySelector("#map"),d=angular.element(c).scope();d.isInitialized?b():$rootScope.$on(eventTypeProvider.MAP_INITIALIZED,b)}
//# sourceMappingURL=tw2autofarm.map